{"version":3,"sources":["webpack:///server.js","webpack:///webpack/bootstrap 7e5f406aee1dac1dce96","webpack:///./server/app.js","webpack:///external \"babel-runtime/core-js/get-iterator\"","webpack:///external \"os\"","webpack:///external \"fs\"","webpack:///external \"child_process\"","webpack:///external \"lodash\"","webpack:///external \"keypair\"","webpack:///./lib/cycle.js","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///external \"babel-runtime/helpers/typeof\"","webpack:///./server/bunyan-stream.js","webpack:///./server/utils.js","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///./lib/common-utils.js","webpack:///./server/setup-server.js","webpack:///external \"restify\"","webpack:///./server/setup-socket.js","webpack:///external \"socket.io\"","webpack:///./server/command-manager.js","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"minimist\"","webpack:///./server/ssh-manager.js","webpack:///external \"babel-runtime/core-js/json/stringify\"","webpack:///external \"ssh2\"","webpack:///external \"terminal-kit\"","webpack:///./server/user-manager.js","webpack:///external \"scrypt\""],"names":["require","install","module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","NodeMonkey","opts","NODE_ENV","process","this","options","_lodash2","merge","server","host","port","silent","bufferSize","client","showCallerInfo","convertStyles","ssh","enabled","title","_os2","hostname","prompt","dataDir","msgBuffer","BUNYAN_STREAM","_bunyanStream2","_setupUserManager","_attachCmdMan","_setupServer","_createLocal","_createRemote","_setupSSH","_getIterator2","_getIterator3","_os","_fs","_fs2","_lodash","_keypair","_keypair2","_cycle","_bunyanStream","_setupServer2","_setupServer3","_setupSocket","_setupSocket2","_sshManager","_sshManager2","_commandManager","_commandManager2","_userManager","_userManager2","assign","prototype","userMan","userManager","userFile","undefined","addCmd","args","output","error","username","_","password","createUser","then","user","setPassword","bind","runCmd","websrv","name","_options$server","listen","console","log","url","remoteClients","onAuth","_sendMessages","clientSettings","sshOpts","Error","files","readdirSync","keyRe","hostKeys","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","next","done","file","value","test","push","err","length","keys","writeFileSync","SSHMan","result","_getCallerInfo","stack","toString","split","caller","find","el","index","arr","callerMatch","match","callerInfo","line","parseInt","column","_sendMessage","info","method","shift","_this","local","_console","each","fn","_this2","remote","forEach","self","Array","slice","arguments","size","adapter","rooms","to","emit","attachConsole","_arguments","serverOptions","apply","detachConsole","inst","_keys","_keys2","_typeof2","_typeof3","origJSON","global","JSON","decycle","object","replacer","objects","paths","derez","path","i","nu","Boolean","Date","Number","RegExp","String","indexOf","$ref","isArray","element","stringify","retrocycle","$","px","rez","eval","item","Object","defineProperty","_utils","_utils2","BUNYAN_TRACE","BUNYAN_DEBUG","BUNYAN_INFO","BUNYAN_WARN","BUNYAN_ERROR","BUNYAN_FATAL","levelFromName","trace","debug","warn","fatal","nameFromLevel","invert","write","rec","parse","src","level","msg","func","_assign","_assign2","_commonUtils","_commonUtils2","parseCommand","str","reg","exec","isObject","type","inverted","k","hasOwnProperty","_restify","_restify2","createServer","pre","userAgentConnection","use","gzipResponse","CORS","credentials","get","serveStatic","directory","__dirname","_socket","_socket2","io","ns","attach","of","on","socket","creds","verifyUser","join","cmdId","command","message","handlers","handler","event","CommandManager","commands","_promise","_promise2","_minimist","_minimist2","cmdName","rawCommand","asUser","resolve","reject","parsed","cmd","SSHManager","clients","clientId","_ssh2","Server","map","readFileSync","onClient","address","SSHClient","session","stream","term","ptyInfo","promptTxt","inputActive","cmdHistory","onReady","onClose","_stringify","_stringify2","_ssh","_terminalKit","_terminalKit2","shutdown","close","style","end","ctx","accept","_this3","once","onWindowChange","_initStream","_initTerm","rows","columns","cols","onKey","matches","data","clearScreen","nextLine","_this4","isTTY","setRawMode","stdout","getWindowSize","createTerminal","stdin","stderr","generic","appName","windowTitle","_interpolate","varRe","vars","replace","clear","_this5","bold","inputField","history","autoComplete","autoCompleteMenu","input","red","UserManager","userFileCache","userFileCreated","_scrypt","_scrypt2","_readFile","setTimeout","code","guest","_writeFile","_hashPassword","passwd","kdfSync","normalize","N","r","_verifyPassword","hash","verifyKdfSync","Buffer","from","users","getUsers","getUserData","_this6","userData"],"mappings":"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","file":"server.js","sourcesContent":["require(\"source-map-support\").install();\nmodule.exports = \n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _getIterator2 = __webpack_require__(1);\n\t\n\tvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\t\n\tvar _os = __webpack_require__(2);\n\t\n\tvar _os2 = _interopRequireDefault(_os);\n\t\n\tvar _fs = __webpack_require__(3);\n\t\n\tvar _fs2 = _interopRequireDefault(_fs);\n\t\n\tvar _child_process = __webpack_require__(4);\n\t\n\tvar _lodash = __webpack_require__(5);\n\t\n\tvar _lodash2 = _interopRequireDefault(_lodash);\n\t\n\tvar _keypair = __webpack_require__(6);\n\t\n\tvar _keypair2 = _interopRequireDefault(_keypair);\n\t\n\tvar _cycle = __webpack_require__(7);\n\t\n\tvar _cycle2 = _interopRequireDefault(_cycle);\n\t\n\tvar _bunyanStream = __webpack_require__(10);\n\t\n\tvar _bunyanStream2 = _interopRequireDefault(_bunyanStream);\n\t\n\tvar _setupServer2 = __webpack_require__(14);\n\t\n\tvar _setupServer3 = _interopRequireDefault(_setupServer2);\n\t\n\tvar _setupSocket = __webpack_require__(16);\n\t\n\tvar _setupSocket2 = _interopRequireDefault(_setupSocket);\n\t\n\tvar _sshManager = __webpack_require__(21);\n\t\n\tvar _sshManager2 = _interopRequireDefault(_sshManager);\n\t\n\tvar _commandManager = __webpack_require__(18);\n\t\n\tvar _commandManager2 = _interopRequireDefault(_commandManager);\n\t\n\tvar _userManager = __webpack_require__(25);\n\t\n\tvar _userManager2 = _interopRequireDefault(_userManager);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction NodeMonkey(opts) {\n\t  var NODE_ENV = process.NODE_ENV;\n\t  var options = this.options = _lodash2.default.merge({\n\t    server: {\n\t      // You can provide your own server and Node Monkey will use it instead of creating its own.\n\t      // However, this MUST be the underlying http server instance, not the express/restify/whatever app.\n\t      server: null,\n\t\n\t      host: '0.0.0.0',\n\t      port: 50500,\n\t      silent: false,\n\t      bufferSize: 50\n\t    },\n\t    client: {\n\t      showCallerInfo: NODE_ENV === 'production' ? false : true,\n\t      convertStyles: true\n\t    },\n\t    ssh: {\n\t      enabled: false,\n\t      host: '127.0.0.1',\n\t      port: 50501,\n\t      title: 'Node Monkey on ' + _os2.default.hostname(),\n\t      prompt: '[Node Monkey] {@username}@' + _os2.default.hostname() + ':'\n\t    },\n\t\n\t    // Needed for storing things like user files and SSH host keys\n\t    dataDir: null\n\t  }, opts);\n\t\n\t  this.msgBuffer = [];\n\t  this.BUNYAN_STREAM = (0, _bunyanStream2.default)(this);\n\t\n\t  this._setupUserManager();\n\t  this._attachCmdMan();\n\t  this._setupServer();\n\t  this._createLocal();\n\t  this._createRemote();\n\t  this._setupSSH();\n\t}\n\t\n\t_lodash2.default.assign(NodeMonkey.prototype, {\n\t  _setupUserManager: function _setupUserManager() {\n\t    var dataDir = this.options.dataDir;\n\t    var userMan = this.userManager = new _userManager2.default({\n\t      userFile: dataDir ? dataDir + '/users.json' : undefined\n\t    });\n\t\n\t    _commandManager2.default.addCmd('adduser', function (args, output, error) {\n\t      var username = args._[0],\n\t          password = args.p;\n\t\n\t      if (!username) {\n\t        return error('You must specify a username');\n\t      }\n\t\n\t      if (!password) {\n\t        return error('You must specify a password with the \\'-p\\' flag');\n\t      }\n\t\n\t      userMan.createUser(username, password).then(function () {\n\t        return output('Created user \\'' + username + '\\'');\n\t      }).catch(error);\n\t    });\n\t\n\t    _commandManager2.default.addCmd('passwd', function (args, output, error, user) {\n\t      var password = args._[0];\n\t\n\t      if (!password) {\n\t        return error('You must specify a password');\n\t      }\n\t\n\t      userMan.setPassword(user, password).then(function () {\n\t        return output('Updated password for \\'' + user + '\\'');\n\t      }).catch(error);\n\t    });\n\t  },\n\t  _attachCmdMan: function _attachCmdMan() {\n\t    this.addCmd = _commandManager2.default.addCmd.bind(_commandManager2.default);\n\t    this.runCmd = _commandManager2.default.runCmd.bind(_commandManager2.default);\n\t  },\n\t  _setupServer: function _setupServer() {\n\t    var options = this.options,\n\t        server = options.websrv;\n\t\n\t    if (!server) {\n\t      server = (0, _setupServer3.default)({\n\t        name: 'Node Monkey'\n\t      });\n\t\n\t      var _options$server = options.server;\n\t      var host = _options$server.host;\n\t      var port = _options$server.port;\n\t\n\t      server.listen(port, host, function () {\n\t        if (!options.server.silent) {\n\t          console.log('Node Monkey listening at ' + server.url);\n\t        }\n\t      });\n\t    }\n\t\n\t    this.server = server;\n\t    this.remoteClients = (0, _setupSocket2.default)({\n\t      server: server.server || server,\n\t      userManager: this.userManager,\n\t      onAuth: this._sendMessages.bind(this),\n\t      clientSettings: options.client\n\t    });\n\t  },\n\t  _setupSSH: function _setupSSH() {\n\t    var sshOpts = this.options.ssh;\n\t    if (sshOpts.enabled) {\n\t      var dataDir = this.options.dataDir;\n\t      if (!dataDir) {\n\t        throw new Error('Options \\'dataDir\\' is required to enable SSH');\n\t      }\n\t\n\t      // Get host keys\n\t      var files = _fs2.default.readdirSync(dataDir),\n\t          keyRe = /\\.key$/,\n\t          hostKeys = [];\n\t      var _iteratorNormalCompletion = true;\n\t      var _didIteratorError = false;\n\t      var _iteratorError = undefined;\n\t\n\t      try {\n\t        for (var _iterator = (0, _getIterator3.default)(files), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t          var file = _step.value;\n\t\n\t          if (keyRe.test(file)) {\n\t            hostKeys.push(dataDir + '/' + file);\n\t          }\n\t        }\n\t      } catch (err) {\n\t        _didIteratorError = true;\n\t        _iteratorError = err;\n\t      } finally {\n\t        try {\n\t          if (!_iteratorNormalCompletion && _iterator.return) {\n\t            _iterator.return();\n\t          }\n\t        } finally {\n\t          if (_didIteratorError) {\n\t            throw _iteratorError;\n\t          }\n\t        }\n\t      }\n\t\n\t      if (!hostKeys.length) {\n\t        console.log('No SSH host key found. Generating new host key...');\n\t        var keys = (0, _keypair2.default)();\n\t        _fs2.default.writeFileSync(dataDir + '/rsa.key', keys.private);\n\t        _fs2.default.writeFileSync(dataDir + '/rsa.key.pub', keys.public);\n\t        hostKeys = [dataDir + '/rsa.key'];\n\t      }\n\t\n\t      this.SSHMan = new _sshManager2.default({\n\t        userManager: this.userManager,\n\t        host: sshOpts.host,\n\t        port: sshOpts.port,\n\t        title: _lodash2.default.result(sshOpts, 'title'),\n\t        prompt: _lodash2.default.result(sshOpts, 'prompt'),\n\t        hostKeys: hostKeys\n\t      });\n\t    }\n\t  },\n\t  _getCallerInfo: function _getCallerInfo() {\n\t    if (this.options.client.showCallerInfo) {\n\t      var stack = new Error().stack.toString().split('\\n'),\n\t          caller = stack.find(function (el, index, arr) {\n\t        return index > 0 && /_sendMessage.+node-monkey/.test(arr[index - 2]);\n\t      });\n\t\n\t      var callerMatch = caller.match(/at (.*) \\((.*):(.*):(.*)\\)/) || caller.match(/at ()(.*):(.*):(.*)/),\n\t          callerInfo = {\n\t        caller: callerMatch[1],\n\t        file: callerMatch[2],\n\t        line: parseInt(callerMatch[3]),\n\t        column: parseInt(callerMatch[4])\n\t      };\n\t\n\t      return callerInfo;\n\t    }\n\t  },\n\t  _sendMessage: function _sendMessage(info) {\n\t    this.msgBuffer.push({\n\t      method: info.method,\n\t      args: info.args,\n\t      callerInfo: info.callerInfo || this._getCallerInfo()\n\t    });\n\t    if (this.msgBuffer.length > this.options.server.bufferSize) {\n\t      this.msgBuffer.shift();\n\t    }\n\t    this._sendMessages();\n\t  },\n\t  _createLocal: function _createLocal() {\n\t    var _this = this;\n\t\n\t    console.local = this._console = {};\n\t    _lodash2.default.each(console, function (fn, method) {\n\t      _this._console[method] = fn;\n\t    });\n\t  },\n\t  _createRemote: function _createRemote() {\n\t    var _this2 = this;\n\t\n\t    if (console.remote) return;\n\t\n\t    console.remote = {};['log', 'info', 'warn', 'error', 'dir'].forEach(function (method) {\n\t      var self = _this2;\n\t\n\t      console.remote[method] = function () {\n\t        self._sendMessage({\n\t          method: method,\n\t          args: Array.prototype.slice.call(arguments)\n\t        });\n\t      };\n\t    });\n\t  },\n\t  _sendMessages: function _sendMessages() {\n\t    var remoteClients = this.remoteClients;\n\t    if (_lodash2.default.size(remoteClients.adapter.rooms['authed'])) {\n\t      _lodash2.default.each(this.msgBuffer, function (info) {\n\t        remoteClients.to('authed').emit('console', info);\n\t      });\n\t\n\t      this.msgBuffer = [];\n\t    }\n\t  },\n\t  attachConsole: function attachConsole() {\n\t    var _arguments = arguments;\n\t\n\t    var serverOptions = this.options.server;\n\t    _lodash2.default.each(console.remote, function (fn, method) {\n\t      console[method] = fn.bind(null, true);\n\t\n\t      if (!serverOptions.silent) {\n\t        self._console[method].apply(console, _arguments);\n\t      }\n\t    });\n\t  },\n\t  detachConsole: function detachConsole() {\n\t    _lodash2.default.each(this._console, function (fn, method) {\n\t      console[method] = fn;\n\t    });\n\t  }\n\t});\n\t\n\tvar inst = void 0;\n\tmodule.exports = function createInst(options) {\n\t  if (!inst) {\n\t    inst = new NodeMonkey(options);\n\t  }\n\t\n\t  return inst;\n\t};\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"babel-runtime/core-js/get-iterator\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"os\");\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"fs\");\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"child_process\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash\");\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"keypair\");\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _keys = __webpack_require__(8);\n\t\n\tvar _keys2 = _interopRequireDefault(_keys);\n\t\n\tvar _typeof2 = __webpack_require__(9);\n\t\n\tvar _typeof3 = _interopRequireDefault(_typeof2);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/*\n\t    cycle.js\n\t    2016-05-01\n\t\n\t    Public Domain.\n\t\n\t    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\t\n\t    This code should be minified before deployment.\n\t    See http://javascript.crockford.com/jsmin.html\n\t\n\t    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n\t    NOT CONTROL.\n\t*/\n\t\n\t/*jslint eval, for */\n\t\n\t/*property\n\t    $ref, decycle, forEach, isArray, keys, length, push, retrocycle, stringify,\n\t    test\n\t*/\n\t\n\tvar origJSON = global.JSON,\n\t    JSON = {};\n\tmodule.exports = JSON;\n\t\n\tif (typeof JSON.decycle !== \"function\") {\n\t    JSON.decycle = function decycle(object, replacer) {\n\t        \"use strict\";\n\t\n\t        // Make a deep copy of an object or array, assuring that there is at most\n\t        // one instance of each object or array in the resulting structure. The\n\t        // duplicate references (which might be forming cycles) are replaced with\n\t        // an object of the form\n\t\n\t        //      {\"$ref\": PATH}\n\t\n\t        // where the PATH is a JSONPath string that locates the first occurance.\n\t\n\t        // So,\n\t\n\t        //      var a = [];\n\t        //      a[0] = a;\n\t        //      return JSON.stringify(JSON.decycle(a));\n\t\n\t        // produces the string '[{\"$ref\":\"$\"}]'.\n\t\n\t        // If a replacer function is provided, then it will be called for each value.\n\t        // A replacer function receives a value and returns a replacement value.\n\t\n\t        // JSONPath is used to locate the unique object. $ indicates the top level of\n\t        // the object or array. [NUMBER] or [STRING] indicates a child element or\n\t        // property.\n\t\n\t        var objects = []; // Keep a reference to each unique object or array\n\t        var paths = []; // Keep the path to each unique object or array\n\t\n\t        return function derez(value, path) {\n\t\n\t            // The derez function recurses through the object, producing the deep copy.\n\t\n\t            var i; // The loop counter\n\t            var nu; // The new object or array\n\t\n\t            // If a replacer function was provided, then call it to get a replacement value.\n\t\n\t            if (replacer !== undefined) {\n\t                value = replacer(value);\n\t            }\n\t\n\t            // typeof null === \"object\", so go on if this value is really an object but not\n\t            // one of the weird builtin objects.\n\t\n\t            if ((typeof value === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(value)) === \"object\" && value !== null && !(value instanceof Boolean) && !(value instanceof Date) && !(value instanceof Number) && !(value instanceof RegExp) && !(value instanceof String)) {\n\t\n\t                // If the value is an object or array, look to see if we have already\n\t                // encountered it. If so, return a {\"$ref\":PATH} object. This is a hard\n\t                // linear search that will get slower as the number of unique objects grows.\n\t                // Someday, this should be replaced with an ES6 WeakMap.\n\t\n\t                i = objects.indexOf(value);\n\t                if (i >= 0) {\n\t                    return { $ref: paths[i] };\n\t                }\n\t\n\t                // Otherwise, accumulate the unique value and its path.\n\t\n\t                objects.push(value);\n\t                paths.push(path);\n\t\n\t                // If it is an array, replicate the array.\n\t\n\t                if (Array.isArray(value)) {\n\t                    nu = [];\n\t                    value.forEach(function (element, i) {\n\t                        nu[i] = derez(element, path + \"[\" + i + \"]\");\n\t                    });\n\t                } else {\n\t\n\t                    // If it is an object, replicate the object.\n\t\n\t                    nu = {};\n\t                    (0, _keys2.default)(value).forEach(function (name) {\n\t                        nu[name] = derez(value[name], path + \"[\" + JSON.stringify(name) + \"]\");\n\t                    });\n\t                }\n\t                return nu;\n\t            }\n\t            return value;\n\t        }(object, \"$\");\n\t    };\n\t}\n\t\n\tif (typeof JSON.retrocycle !== \"function\") {\n\t    JSON.retrocycle = function retrocycle($) {\n\t        \"use strict\";\n\t\n\t        // Restore an object that was reduced by decycle. Members whose values are\n\t        // objects of the form\n\t        //      {$ref: PATH}\n\t        // are replaced with references to the value found by the PATH. This will\n\t        // restore cycles. The object will be mutated.\n\t\n\t        // The eval function is used to locate the values described by a PATH. The\n\t        // root object is kept in a $ variable. A regular expression is used to\n\t        // assure that the PATH is extremely well formed. The regexp contains nested\n\t        // * quantifiers. That has been known to have extremely bad performance\n\t        // problems on some browsers for very long strings. A PATH is expected to be\n\t        // reasonably short. A PATH is allowed to belong to a very restricted subset of\n\t        // Goessner's JSONPath.\n\t\n\t        // So,\n\t        //      var s = '[{\"$ref\":\"$\"}]';\n\t        //      return JSON.retrocycle(JSON.parse(s));\n\t        // produces an array containing a single element which is the array itself.\n\t\n\t        var px = /^\\$(?:\\[(?:\\d+|\\\"(?:[^\\\\\\\"\\u0000-\\u001f]|\\\\([\\\\\\\"\\/bfnrt]|u[0-9a-zA-Z]{4}))*\\\")\\])*$/;\n\t\n\t        (function rez(value) {\n\t\n\t            // The rez function walks recursively through the object looking for $ref\n\t            // properties. When it finds one that has a value that is a path, then it\n\t            // replaces the $ref object with a reference to the value that is found by\n\t            // the path.\n\t\n\t            if (value && (typeof value === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(value)) === \"object\") {\n\t                if (Array.isArray(value)) {\n\t                    value.forEach(function (element, i) {\n\t                        if ((typeof element === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(element)) === \"object\" && element !== null) {\n\t                            var path = element.$ref;\n\t                            if (typeof path === \"string\" && px.test(path)) {\n\t                                value[i] = eval(path);\n\t                            } else {\n\t                                rez(element);\n\t                            }\n\t                        }\n\t                    });\n\t                } else {\n\t                    (0, _keys2.default)(value).forEach(function (name) {\n\t                        var item = value[name];\n\t                        if ((typeof item === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(item)) === \"object\" && item !== null) {\n\t                            var path = item.$ref;\n\t                            if (typeof path === \"string\" && px.test(path)) {\n\t                                value[name] = eval(path);\n\t                            } else {\n\t                                rez(item);\n\t                            }\n\t                        }\n\t                    });\n\t                }\n\t            }\n\t        })($);\n\t        return $;\n\t    };\n\t}\n\t\n\tJSON = origJSON;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"babel-runtime/core-js/object/keys\");\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"babel-runtime/helpers/typeof\");\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _utils = __webpack_require__(11);\n\t\n\tvar _utils2 = _interopRequireDefault(_utils);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar BUNYAN_TRACE = 10;\n\tvar BUNYAN_DEBUG = 20;\n\tvar BUNYAN_INFO = 30;\n\tvar BUNYAN_WARN = 40;\n\tvar BUNYAN_ERROR = 50;\n\tvar BUNYAN_FATAL = 60;\n\t\n\tvar levelFromName = {\n\t  'trace': BUNYAN_TRACE,\n\t  'debug': BUNYAN_DEBUG,\n\t  'info': BUNYAN_INFO,\n\t  'warn': BUNYAN_WARN,\n\t  'error': BUNYAN_ERROR,\n\t  'fatal': BUNYAN_FATAL\n\t},\n\t    nameFromLevel = _utils2.default.invert(levelFromName);\n\t\n\texports.default = function (inst) {\n\t  return {\n\t    write: function write(rec) {\n\t      // TODO: Look for the first call that didn't originate in bunyan.js\n\t      rec = JSON.parse(rec);\n\t      var src = rec.src;\n\t      inst._sendMessage({\n\t        method: nameFromLevel[rec.level] || 'info',\n\t        args: [rec.msg, rec],\n\t        callerInfo: src && {\n\t          caller: src.func || 'anonymous',\n\t          file: src.file,\n\t          line: src.line,\n\t          column: 0\n\t        }\n\t      });\n\t    }\n\t  };\n\t};\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _assign = __webpack_require__(12);\n\t\n\tvar _assign2 = _interopRequireDefault(_assign);\n\t\n\tvar _commonUtils = __webpack_require__(13);\n\t\n\tvar _commonUtils2 = _interopRequireDefault(_commonUtils);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = (0, _assign2.default)({\n\t  parseCommand: function parseCommand(str) {\n\t    var reg = /\"(.*?)\"|'(.*?)'|`(.*?)`|([^\\s\"]+)/gi;\n\t    var arr = [],\n\t        match = void 0;\n\t\n\t    do {\n\t      match = reg.exec(str);\n\t      if (match !== null) {\n\t        arr.push(match[1] || match[2] || match[3] || match[4]);\n\t      }\n\t    } while (match !== null);\n\t\n\t    return arr;\n\t  }\n\t}, _commonUtils2.default);\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"babel-runtime/core-js/object/assign\");\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _typeof2 = __webpack_require__(9);\n\t\n\tvar _typeof3 = _interopRequireDefault(_typeof2);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tmodule.exports = {\n\t  isObject: function isObject(value) {\n\t    var type = typeof value === 'undefined' ? 'undefined' : (0, _typeof3.default)(value);\n\t    return !!value && (type == 'object' || type == 'function');\n\t  },\n\t  invert: function invert(obj) {\n\t    var inverted = {};\n\t    for (var k in obj) {\n\t      if (obj.hasOwnProperty(k)) {\n\t        inverted[obj[k]] = k;\n\t      }\n\t    }\n\t\n\t    return inverted;\n\t  }\n\t};\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _restify = __webpack_require__(15);\n\t\n\tvar _restify2 = _interopRequireDefault(_restify);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = function (options) {\n\t  var server = _restify2.default.createServer();\n\t\n\t  server.pre(_restify2.default.pre.userAgentConnection());\n\t  server.use(_restify2.default.gzipResponse());\n\t  server.use(_restify2.default.CORS({\n\t    credentials: true\n\t  }));\n\t\n\t  server.get(/.*/, _restify2.default.serveStatic({\n\t    directory: __dirname,\n\t    default: 'index.html'\n\t  }));\n\t\n\t  return server;\n\t};\n\n/***/ },\n/* 15 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"restify\");\n\n/***/ },\n/* 16 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _lodash = __webpack_require__(5);\n\t\n\tvar _lodash2 = _interopRequireDefault(_lodash);\n\t\n\tvar _socket = __webpack_require__(17);\n\t\n\tvar _socket2 = _interopRequireDefault(_socket);\n\t\n\tvar _commandManager = __webpack_require__(18);\n\t\n\tvar _commandManager2 = _interopRequireDefault(_commandManager);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = function (options) {\n\t  var io = void 0,\n\t      ns = void 0;\n\t  var userManager = options.userManager;\n\t\n\t  if (typeof options.server === 'function') {\n\t    io = (0, _socket2.default)(options.server);\n\t  } else {\n\t    io = (0, _socket2.default)();\n\t    io.attach(options.server);\n\t  }\n\t\n\t  ns = io.of('/nm');\n\t  ns.on('connection', function (socket) {\n\t    socket.emit('settings', options.clientSettings);\n\t    socket.emit('auth');\n\t\n\t    socket.on('auth', function (creds) {\n\t      userManager.verifyUser(creds.username, creds.password).then(function (result) {\n\t        if (result) {\n\t          socket.username = creds.username;\n\t          socket.join('authed');\n\t          if (options.onAuth) {\n\t            options.onAuth(socket);\n\t          }\n\t        } else {\n\t          socket.emit('auth');\n\t        }\n\t      }).catch(function (err) {\n\t        socket.emit('auth');\n\t      });\n\t    });\n\t\n\t    socket.on('cmd', function (cmdId, command) {\n\t      _commandManager2.default.runCmd(command, socket.username).then(function (output) {\n\t        socket.emit('cmdResponse', cmdId, null, output);\n\t      }).catch(function (err) {\n\t        socket.emit('cmdResponse', cmdId, err && err.message || err, null);\n\t      });\n\t    });\n\t  });\n\t\n\t  _lodash2.default.each(options.handlers, function (handler, event) {\n\t    io.on(event, handler);\n\t  });\n\t\n\t  return ns;\n\t};\n\n/***/ },\n/* 17 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"socket.io\");\n\n/***/ },\n/* 18 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _promise = __webpack_require__(19);\n\t\n\tvar _promise2 = _interopRequireDefault(_promise);\n\t\n\tvar _assign = __webpack_require__(12);\n\t\n\tvar _assign2 = _interopRequireDefault(_assign);\n\t\n\tvar _utils = __webpack_require__(11);\n\t\n\tvar _utils2 = _interopRequireDefault(_utils);\n\t\n\tvar _minimist = __webpack_require__(20);\n\t\n\tvar _minimist2 = _interopRequireDefault(_minimist);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction CommandManager() {\n\t  this.commands = {};\n\t}\n\t\n\t(0, _assign2.default)(CommandManager.prototype, {\n\t  addCmd: function addCmd(cmdName, opts, exec) {\n\t    if (this.commands[cmdName]) {\n\t      throw new Error('\\'' + cmdName + '\\' is already registered as a command');\n\t    }\n\t\n\t    if (typeof opts === 'function') {\n\t      exec = opts;\n\t      opts = {};\n\t    }\n\t\n\t    this.commands[cmdName] = {\n\t      opts: opts,\n\t      exec: exec\n\t    };\n\t  },\n\t  runCmd: function runCmd(rawCommand, asUser) {\n\t    var _this = this;\n\t\n\t    return new _promise2.default(function (resolve, reject) {\n\t      var parsed = _utils2.default.parseCommand(rawCommand),\n\t          cmdName = parsed[0],\n\t          cmd = _this.commands[cmdName];\n\t\n\t      if (!asUser) {\n\t        return reject('Missing user context for command \\'' + cmdName + '\\'');\n\t      }\n\t\n\t      if (!cmd) {\n\t        return reject('Command not found: \\'' + cmdName + '\\'');\n\t      }\n\t\n\t      var args = (0, _minimist2.default)(parsed.slice(1));\n\t      cmd.exec(args, resolve, reject, asUser);\n\t    });\n\t  }\n\t});\n\t\n\texports.default = new CommandManager();\n\n/***/ },\n/* 19 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"babel-runtime/core-js/promise\");\n\n/***/ },\n/* 20 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"minimist\");\n\n/***/ },\n/* 21 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _stringify = __webpack_require__(22);\n\t\n\tvar _stringify2 = _interopRequireDefault(_stringify);\n\t\n\tvar _keys = __webpack_require__(8);\n\t\n\tvar _keys2 = _interopRequireDefault(_keys);\n\t\n\tvar _getIterator2 = __webpack_require__(1);\n\t\n\tvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\t\n\tvar _assign = __webpack_require__(12);\n\t\n\tvar _assign2 = _interopRequireDefault(_assign);\n\t\n\tvar _fs = __webpack_require__(3);\n\t\n\tvar _fs2 = _interopRequireDefault(_fs);\n\t\n\tvar _ssh = __webpack_require__(23);\n\t\n\tvar _ssh2 = _interopRequireDefault(_ssh);\n\t\n\tvar _terminalKit = __webpack_require__(24);\n\t\n\tvar _terminalKit2 = _interopRequireDefault(_terminalKit);\n\t\n\tvar _commandManager = __webpack_require__(18);\n\t\n\tvar _commandManager2 = _interopRequireDefault(_commandManager);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction SSHManager(options) {\n\t  this.options = options = (0, _assign2.default)({\n\t    host: '127.0.0.1',\n\t    port: 50501,\n\t    title: 'Node Monkey',\n\t    prompt: 'Node Monkey:'\n\t  }, options);\n\t\n\t  this.clients = {};\n\t  this.clientId = 1;\n\t\n\t  this.server = _ssh2.default.Server({\n\t    hostKeys: options.hostKeys.map(function (file) {\n\t      return _fs2.default.readFileSync(file);\n\t    })\n\t  }, this.onClient.bind(this));\n\t\n\t  this.server.listen(options.port, options.host, function () {\n\t    console.log('Listening on ' + this.address().port);\n\t  });\n\t}\n\t\n\t(0, _assign2.default)(SSHManager.prototype, {\n\t  shutdown: function shutdown() {\n\t    var clients = this.clients;\n\t    var _iteratorNormalCompletion = true;\n\t    var _didIteratorError = false;\n\t    var _iteratorError = undefined;\n\t\n\t    try {\n\t      for (var _iterator = (0, _getIterator3.default)(clients), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t        var c = _step.value;\n\t\n\t        c.write('\\nShutting down');\n\t        c.close();\n\t      }\n\t    } catch (err) {\n\t      _didIteratorError = true;\n\t      _iteratorError = err;\n\t    } finally {\n\t      try {\n\t        if (!_iteratorNormalCompletion && _iterator.return) {\n\t          _iterator.return();\n\t        }\n\t      } finally {\n\t        if (_didIteratorError) {\n\t          throw _iteratorError;\n\t        }\n\t      }\n\t    }\n\t  },\n\t  onClient: function onClient(client) {\n\t    var _this = this;\n\t\n\t    var clientId = clientId++;\n\t    this.clients[clientId] = new SSHClient({\n\t      client: client,\n\t      userManager: this.options.userManager,\n\t      title: this.options.title,\n\t      prompt: this.options.prompt,\n\t      onClose: function onClose() {\n\t        return delete _this.clients[clientId];\n\t      }\n\t    });\n\t  }\n\t});\n\t\n\tfunction SSHClient(options) {\n\t  this.options = options;\n\t  this.client = options.client;\n\t  this.userManager = options.userManager;\n\t  this.session = null;\n\t  this.stream = null;\n\t  this.term = null;\n\t  this.ptyInfo = null;\n\t\n\t  this.title = options.title;\n\t  this.promptTxt = options.prompt + ' ';\n\t  this.inputActive = false;\n\t  this.cmdHistory = [];\n\t\n\t  this.username = null;\n\t\n\t  this.client.on('authentication', this.onAuth.bind(this));\n\t  this.client.on('ready', this.onReady.bind(this));\n\t  this.client.on('end', this.onClose.bind(this));\n\t}\n\t\n\t(0, _assign2.default)(SSHClient.prototype, {\n\t  write: function write(msg, opts) {\n\t    opts || (opts = {});\n\t    if (this.term) {\n\t      if (opts.style) {\n\t        this.term[style](msg);\n\t      } else {\n\t        this.term(msg);\n\t      }\n\t    }\n\t  },\n\t  close: function close() {\n\t    if (this.stream) {\n\t      this.stream.end();\n\t    }\n\t    this.onClose();\n\t  },\n\t  onAuth: function onAuth(ctx) {\n\t    var _this2 = this;\n\t\n\t    if (ctx.method == 'password') {\n\t      this.userManager.verifyUser(ctx.username, ctx.password).then(function (result) {\n\t        if (result) {\n\t          _this2.username = ctx.username;\n\t          ctx.accept();\n\t        } else {\n\t          ctx.reject();\n\t        }\n\t      }).catch(function (err) {\n\t        ctx.reject();\n\t      });\n\t    } else if (ctx.method == 'publickey') {\n\t      ctx.reject();\n\t    } else {\n\t      ctx.reject();\n\t    }\n\t  },\n\t  onReady: function onReady() {\n\t    var _this3 = this;\n\t\n\t    this.client.on('session', function (accept, reject) {\n\t      _this3.session = accept();\n\t\n\t      _this3.session.once('pty', function (accept, reject, info) {\n\t        _this3.ptyInfo = info;\n\t        accept && accept();\n\t      }).on('window-change', _this3.onWindowChange.bind(_this3)).once('shell', function (accept, reject) {\n\t        _this3.stream = accept();\n\t        _this3._initStream();\n\t        _this3._initTerm();\n\t      });\n\t    });\n\t  },\n\t  onWindowChange: function onWindowChange(accept, reject, info) {\n\t    var stream = this.stream;\n\t    (0, _assign2.default)(this.ptyInfo, info);\n\t    if (stream) {\n\t      stream.rows = info.rows;\n\t      stream.columns = info.cols;\n\t      stream.emit('resize');\n\t    }\n\t    accept && accept();\n\t  },\n\t  onClose: function onClose() {\n\t    var onClose = this.options.onClose;\n\t    onClose && onClose();\n\t  },\n\t  onKey: function onKey(name, matches, data) {\n\t    if (name === 'CTRL_L') {\n\t      this.clearScreen();\n\t    } else if (name === 'CTRL_D') {\n\t      this.term.nextLine();\n\t      this.close();\n\t    }\n\t  },\n\t  _initStream: function _initStream() {\n\t    var _this4 = this;\n\t\n\t    var stream = this.stream;\n\t    stream.name = this.title;\n\t    stream.rows = this.ptyInfo.rows || 24;\n\t    stream.columns = this.ptyInfo.cols || 80;\n\t    stream.isTTY = true;\n\t    stream.setRawMode = function () {};\n\t    stream.on('error', function (error) {\n\t      console.error('SSH stream error:', error.message);\n\t    });\n\t    stream.stdout.getWindowSize = function () {\n\t      return [_this4.ptyInfo.cols, _this4.ptyInfo.rows];\n\t    };\n\t  },\n\t  _initTerm: function _initTerm() {\n\t    var stream = this.stream;\n\t\n\t    var term = this.term = _terminalKit2.default.createTerminal({\n\t      stdin: stream.stdin,\n\t      stdout: stream.stdout,\n\t      stderr: stream.stderr,\n\t      generic: this.ptyInfo.term,\n\t      appName: this.title\n\t    });\n\t\n\t    term.on('key', this.onKey.bind(this));\n\t    term.windowTitle(this._interpolate(this.title));\n\t    this.clearScreen();\n\t  },\n\t  _interpolate: function _interpolate(str) {\n\t    var varRe = /{@(.+?)}/g;\n\t    var vars = {\n\t      username: this.username\n\t    };\n\t\n\t    var match = void 0;\n\t    while (match = varRe.exec(str)) {\n\t      if (vars[match[1]]) {\n\t        str = str.replace(match[0], vars[match[1]]);\n\t      }\n\t    }\n\t\n\t    return str;\n\t  },\n\t  clearScreen: function clearScreen() {\n\t    this.term.clear();\n\t    this.prompt();\n\t  },\n\t  prompt: function prompt() {\n\t    var _this5 = this;\n\t\n\t    var term = this.term;\n\t    term.windowTitle(this._interpolate(this.title));\n\t    term.bold(this._interpolate(this.promptTxt));\n\t\n\t    if (!this.inputActive) {\n\t      this.inputActive = true;\n\t      term.inputField({\n\t        history: this.cmdHistory,\n\t        autoComplete: (0, _keys2.default)(_commandManager2.default.commands),\n\t        autoCompleteMenu: true\n\t      }, function (error, input) {\n\t        _this5.inputActive = false;\n\t        input[0] !== ' ' && _this5.cmdHistory.push(input);\n\t        term.nextLine();\n\t\n\t        if (input === 'exit') {\n\t          _this5.close();\n\t        } else if (input === 'clear') {\n\t          _this5.clearScreen();\n\t        } else if (input) {\n\t          _commandManager2.default.runCmd(input, _this5.username).then(function (output) {\n\t            if (typeof output !== 'string') {\n\t              output = (0, _stringify2.default)(output, null, '  ');\n\t            }\n\t            _this5.term(output.replace(/(\\n+)/g, '\\r$1'));\n\t            _this5.term.nextLine();\n\t            _this5.prompt();\n\t          }).catch(function (err) {\n\t            if (typeof err !== 'string') {\n\t              err = err.message || (0, _stringify2.default)(err, null, '  ');\n\t            }\n\t            _this5.term.red.error(err.replace(/(\\n+)/g, '\\r$1'));\n\t            _this5.term.nextLine();\n\t            _this5.prompt();\n\t          });\n\t        } else {\n\t          _this5.prompt();\n\t        }\n\t      });\n\t    }\n\t  }\n\t});\n\t\n\texports.default = SSHManager;\n\t\n\t// ssh2.Server({\n\t//   hostKeys: [\n\t//     fs.readFileSync(`${__dirname}/ssh/hostkey_rsa`),\n\t//     fs.readFileSync(`${__dirname}/ssh/hostkey_dsa`)\n\t//   ]\n\t// }, function(client) {\n\t//   client.on('authentication', function(ctx) {\n\t//     if (ctx.method == 'password') {\n\t//       if (ctx.username == 'guest' && ctx.password == 'guest') {\n\t//         ctx.accept()\n\t//       } else {\n\t//         ctx.reject()\n\t//       }\n\t//     } else if (ctx.method == 'publickey') {\n\t//       ctx.reject()\n\t//     } else {\n\t//       ctx.reject()\n\t//     }\n\t//   }).on('ready', function() {\n\t//     console.log('Client authenticated!')\n\t\n\t//     client.on('session', function(accept, reject) {\n\t//       let session = accept(),\n\t//           stream,title\n\t//           rows, cols, term,\n\t//           cmdHistory = []\n\t\n\t//       session.once('pty', function(accept, reject, info) {\n\t//         rows = info.rows\n\t//         cols = info.cols\n\t//         term = info.term\n\t//         accept && accept()\n\t//       }).on('window-change', function(accept, reject, info) {\n\t//         rows = info.rows\n\t//         cols = info.cols\n\t//         if (stream) {\n\t//           stream.rows = rows\n\t//           stream.columns = cols\n\t//           stream.emit('resize')\n\t//         }\n\t//         accept && accept()\n\t//       }).once('shell', function(accept, reject) {\n\t//         let title = `Node Monkey@${os.hostname()}`,\n\t//             promptTxt = `${title}: `\n\t\n\t//         stream = accept()\n\t//         stream.name = title\n\t//         stream.rows = rows || 24\n\t//         stream.columns = cols || 80\n\t//         stream.isTTY = true\n\t//         stream.setRawMode = () => {}\n\t//         stream.on('error', error => {\n\t//           console.error('SSH stream error:', error.message)\n\t//         })\n\t//         stream.stdout.getWindowSize = () => {\n\t//           return [ cols, rows ]\n\t//         }\n\t\n\t//         let terminal = termkit.createTerminal({\n\t//           stdin: stream.stdin,\n\t//           stdout: stream.stdout,\n\t//           stderr: stream.stderr,\n\t//           generic: term,\n\t//           appName: title\n\t//         })\n\t\n\t//         let inputActive = false\n\t//         function prompt() {\n\t//           terminal.bold(promptTxt)\n\t\n\t//           if (!inputActive) {\n\t//             inputActive = true\n\t//             terminal.inputField({\n\t//               history: cmdHistory\n\t//             }, (error, input) => {\n\t//               inputActive = false\n\t//               cmdHistory.push(input)\n\t//               terminal.nextLine()\n\t\n\t//               if (input === 'exit') {\n\t//                 stream.end()\n\t//               } else if (input === 'clear') {\n\t//                 clearScreen()\n\t//               } else if (input) {\n\t//                 let args = minimist(parseCommand(input).slice(1))\n\t//                 // Run command and wait for completion before prompt\n\t//                 prompt()\n\t//               } else {\n\t//                 prompt()\n\t//               }\n\t//             })\n\t//           }\n\t//         }\n\t\n\t//         function clearScreen() {\n\t//           terminal.clear()\n\t//           prompt()\n\t//         }\n\t\n\t//         terminal.on('key', (name, matches, data) => {\n\t//           if (name === 'CTRL_L') {\n\t//             clearScreen()\n\t//           } else if (name === 'CTRL_D') {\n\t//             terminal.nextLine()\n\t//             stream.end()\n\t//           }\n\t//         })\n\t\n\t//         terminal.windowTitle(title)\n\t//         clearScreen()\n\t//       })\n\t//     })\n\t//   }).on('end', function() {\n\t//     console.log('Client disconnected')\n\t//   })\n\t// }).listen(50501, '127.0.0.1', function() {\n\t//   console.log(`Listening on ${this.address().port}`)\n\t// })\n\n/***/ },\n/* 22 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n/***/ },\n/* 23 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"ssh2\");\n\n/***/ },\n/* 24 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"terminal-kit\");\n\n/***/ },\n/* 25 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _promise = __webpack_require__(19);\n\t\n\tvar _promise2 = _interopRequireDefault(_promise);\n\t\n\tvar _stringify = __webpack_require__(22);\n\t\n\tvar _stringify2 = _interopRequireDefault(_stringify);\n\t\n\tvar _assign = __webpack_require__(12);\n\t\n\tvar _assign2 = _interopRequireDefault(_assign);\n\t\n\tvar _fs = __webpack_require__(3);\n\t\n\tvar _fs2 = _interopRequireDefault(_fs);\n\t\n\tvar _scrypt = __webpack_require__(26);\n\t\n\tvar _scrypt2 = _interopRequireDefault(_scrypt);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction UserManager(options) {\n\t  this.userFile = options.userFile;\n\t  this.userFileCache = null;\n\t  this.userFileCreated = false;\n\t}\n\t\n\t(0, _assign2.default)(UserManager.prototype, {\n\t  _readFile: function _readFile() {\n\t    var _this = this;\n\t\n\t    if (this.userFileCache) {\n\t      return this.userFileCache;\n\t    }\n\t\n\t    try {\n\t      this.userFileCache = JSON.parse(_fs2.default.readFileSync(this.userFile));\n\t      this.userFileCreated = true;\n\t      setTimeout(function () {\n\t        _this.userFileCache = null;\n\t      }, 5000);\n\t\n\t      return this.userFileCache;\n\t    } catch (err) {\n\t      if (err.code === 'ENOENT') {\n\t        return {\n\t          guest: {\n\t            password: 'c2NyeXB0AAEAAAABAAAAAZS+vE1+zh4nY6vN21zM3dIzpJVImr8OrK0iJoA+iUPk7WIdo3RhgeATzWENocd7gKNbEKVgq6LbXqrmVjLtnYy5FXyfRCtEtmjUuj19AqcW'\n\t          }\n\t        };\n\t      }\n\t      throw err;\n\t    }\n\t  },\n\t  _writeFile: function _writeFile(data) {\n\t    this.userFileCache = null;\n\t    _fs2.default.writeFileSync(this.userFile, (0, _stringify2.default)(data, null, '  '));\n\t    this.userFileCreated = true;\n\t  },\n\t  _hashPassword: function _hashPassword(passwd) {\n\t    return _scrypt2.default.kdfSync(passwd.normalize('NFKC'), { N: 1, r: 1, p: 1 }).toString('base64');\n\t  },\n\t  _verifyPassword: function _verifyPassword(hash, passwd) {\n\t    return _scrypt2.default.verifyKdfSync(Buffer.from(hash, 'base64'), passwd.normalize('NFKC'));\n\t  },\n\t  createUser: function createUser(username, password) {\n\t    var _this2 = this;\n\t\n\t    return new _promise2.default(function (resolve, reject) {\n\t      if (!_this2.userFile) {\n\t        return reject(new Error('No user file found. Did you forget to set the \\'dataDir\\' option?'));\n\t      }\n\t\n\t      var users = _this2._readFile();\n\t      if (users[username]) {\n\t        return reject(new Error('User \\'' + username + '\\' already exists'));\n\t      }\n\t\n\t      if (!_this2.userFileCreated) {\n\t        delete users['guest'];\n\t      }\n\t\n\t      users[username] = {\n\t        password: _this2._hashPassword(password)\n\t      };\n\t      _this2._writeFile(users);\n\t      resolve();\n\t    });\n\t  },\n\t  setPassword: function setPassword(username, password) {\n\t    var _this3 = this;\n\t\n\t    return new _promise2.default(function (resolve, reject) {\n\t      if (!_this3.userFile) {\n\t        return reject(new Error('No user file found. Did you forget to set the \\'dataDir\\' option?'));\n\t      }\n\t\n\t      var users = _this3._readFile();\n\t\n\t      users[username].password = _this3._hashPassword(password);\n\t      _this3._writeFile(users);\n\t      resolve();\n\t    });\n\t  },\n\t  getUsers: function getUsers() {\n\t    var _this4 = this;\n\t\n\t    return new _promise2.default(function (resolve, reject) {\n\t      resolve(_this4._readFile());\n\t    });\n\t  },\n\t  getUserData: function getUserData(username) {\n\t    var _this5 = this;\n\t\n\t    return new _promise2.default(function (resolve, reject) {\n\t      var users = _this5._readFile();\n\t      if (!users[username]) {\n\t        return reject('User \\'' + username + '\\' does not exist');\n\t      }\n\t\n\t      resolve(users[username]);\n\t    });\n\t  },\n\t  verifyUser: function verifyUser(username, passwd) {\n\t    var _this6 = this;\n\t\n\t    return new _promise2.default(function (resolve, reject) {\n\t      _this6.getUserData(username).then(function (userData) {\n\t        resolve(_this6._verifyPassword(userData.password, passwd));\n\t      }).catch(reject);\n\t    });\n\t  }\n\t});\n\t\n\texports.default = UserManager;\n\n/***/ },\n/* 26 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"scrypt\");\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** server.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 7e5f406aee1dac1dce96\n **/","import os from 'os'\nimport fs from 'fs'\nimport { execSync } from 'child_process'\nimport _ from 'lodash'\nimport keypair from 'keypair'\nimport cycle from '../lib/cycle'\nimport bunyanStream from './bunyan-stream'\nimport setupServer from './setup-server'\nimport setupSocket from './setup-socket'\nimport SSHMan from './ssh-manager'\nimport CmdMan from './command-manager'\nimport UserManager from './user-manager'\n\nfunction NodeMonkey(opts) {\n  const NODE_ENV = process.NODE_ENV\n  let options = this.options = _.merge({\n    server: {\n      // You can provide your own server and Node Monkey will use it instead of creating its own.\n      // However, this MUST be the underlying http server instance, not the express/restify/whatever app.\n      server: null,\n\n      host: '0.0.0.0',\n      port: 50500,\n      silent: false,\n      bufferSize: 50\n    },\n    client: {\n      showCallerInfo: NODE_ENV === 'production' ? false : true,\n      convertStyles: true\n    },\n    ssh: {\n      enabled: false,\n      host: '127.0.0.1',\n      port: 50501,\n      title: `Node Monkey on ${os.hostname()}`,\n      prompt: `[Node Monkey] {@username}@${os.hostname()}:`\n    },\n\n    // Needed for storing things like user files and SSH host keys\n    dataDir: null\n  }, opts)\n\n  this.msgBuffer = []\n  this.BUNYAN_STREAM = bunyanStream(this)\n\n  this._setupUserManager()\n  this._attachCmdMan()\n  this._setupServer()\n  this._createLocal()\n  this._createRemote()\n  this._setupSSH()\n}\n\n_.assign(NodeMonkey.prototype, {\n  _setupUserManager() {\n    let dataDir = this.options.dataDir\n    let userMan = this.userManager = new UserManager({\n      userFile: dataDir ? `${dataDir}/users.json` : undefined\n    })\n\n    CmdMan.addCmd('adduser', (args, output, error) => {\n      let username = args._[0],\n          password = args.p\n\n      if (!username) {\n        return error(`You must specify a username`)\n      }\n\n      if (!password) {\n        return error(`You must specify a password with the '-p' flag`)\n      }\n\n      userMan.createUser(username, password)\n        .then(() => output(`Created user '${username}'`))\n        .catch(error)\n    })\n\n    CmdMan.addCmd('passwd', (args, output, error, user) => {\n      let password = args._[0]\n\n      if (!password) {\n        return error(`You must specify a password`)\n      }\n\n      userMan.setPassword(user, password)\n        .then(() => output(`Updated password for '${user}'`))\n        .catch(error)\n    })\n  },\n\n  _attachCmdMan() {\n    this.addCmd = CmdMan.addCmd.bind(CmdMan)\n    this.runCmd = CmdMan.runCmd.bind(CmdMan)\n  },\n\n  _setupServer() {\n    let options = this.options,\n        server = options.websrv\n\n    if (!server) {\n      server = setupServer({\n        name: 'Node Monkey'\n      })\n\n      let { host, port } = options.server\n      server.listen(port, host, () => {\n        if (!options.server.silent) {\n          console.log(`Node Monkey listening at ${server.url}`)\n        }\n      })\n    }\n\n    this.server = server\n    this.remoteClients = setupSocket({\n      server: server.server || server,\n      userManager: this.userManager,\n      onAuth: this._sendMessages.bind(this),\n      clientSettings: options.client\n    })\n  },\n\n  _setupSSH() {\n    let sshOpts = this.options.ssh\n    if (sshOpts.enabled) {\n      let dataDir = this.options.dataDir\n      if (!dataDir) {\n        throw new Error(`Options 'dataDir' is required to enable SSH`)\n      }\n\n      // Get host keys\n      let files = fs.readdirSync(dataDir),\n          keyRe = /\\.key$/,\n          hostKeys = []\n      for (let file of files) {\n        if (keyRe.test(file)) {\n          hostKeys.push(`${dataDir}/${file}`)\n        }\n      }\n\n      if (!hostKeys.length) {\n        console.log('No SSH host key found. Generating new host key...')\n        let keys = keypair()\n        fs.writeFileSync(`${dataDir}/rsa.key`, keys.private)\n        fs.writeFileSync(`${dataDir}/rsa.key.pub`, keys.public)\n        hostKeys = [ `${dataDir}/rsa.key` ]\n      }\n\n      this.SSHMan = new SSHMan({\n        userManager: this.userManager,\n        host: sshOpts.host,\n        port: sshOpts.port,\n        title: _.result(sshOpts, 'title'),\n        prompt: _.result(sshOpts, 'prompt'),\n        hostKeys\n      })\n    }\n  },\n\n  _getCallerInfo() {\n    if (this.options.client.showCallerInfo) {\n      var stack = (new Error()).stack.toString().split('\\n'),\n          caller = stack.find((el, index, arr) => {\n            return index > 0 && /_sendMessage.+node-monkey/.test(arr[index - 2])\n          })\n\n      let callerMatch = caller.match(/at (.*) \\((.*):(.*):(.*)\\)/) || caller.match(/at ()(.*):(.*):(.*)/),\n          callerInfo = {\n            caller: callerMatch[1],\n            file: callerMatch[2],\n            line: parseInt(callerMatch[3]),\n            column: parseInt(callerMatch[4])\n          }\n\n      return callerInfo\n    }\n  },\n\n  _sendMessage(info) {\n    this.msgBuffer.push({\n      method: info.method,\n      args: info.args,\n      callerInfo: info.callerInfo || this._getCallerInfo()\n    })\n    if (this.msgBuffer.length > this.options.server.bufferSize) {\n      this.msgBuffer.shift()\n    }\n    this._sendMessages()\n  },\n\n  _createLocal() {\n    console.local = this._console = {}\n    _.each(console, (fn, method) => {\n      this._console[method] = fn\n    })\n  },\n\n  _createRemote() {\n    if (console.remote) return\n\n    console.remote = {}\n    ;[ 'log', 'info', 'warn', 'error', 'dir' ].forEach(method => {\n      let self = this\n\n      console.remote[method] = function() {\n        self._sendMessage({\n          method,\n          args: Array.prototype.slice.call(arguments)\n        })\n      }\n    })\n  },\n\n  _sendMessages() {\n    let remoteClients = this.remoteClients\n    if (_.size(remoteClients.adapter.rooms['authed'])) {\n      _.each(this.msgBuffer, info => {\n        remoteClients.to('authed').emit('console', info)\n      })\n\n      this.msgBuffer = []\n    }\n  },\n\n  attachConsole() {\n    let serverOptions = this.options.server\n    _.each(console.remote, (fn, method) => {\n      console[method] = fn.bind(null, true)\n\n      if (!serverOptions.silent) {\n        self._console[method].apply(console, arguments)\n      }\n    })\n  },\n\n  detachConsole() {\n    _.each(this._console, (fn, method) => {\n      console[method] = fn\n    })\n  }\n})\n\n\nlet inst\nmodule.exports = function createInst(options) {\n  if (!inst) {\n    inst = new NodeMonkey(options)\n  }\n\n  return inst\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/app.js\n **/","module.exports = require(\"babel-runtime/core-js/get-iterator\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-runtime/core-js/get-iterator\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"os\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"os\"\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"child_process\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"child_process\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"lodash\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"lodash\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"keypair\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"keypair\"\n ** module id = 6\n ** module chunks = 0\n **/","/*\n    cycle.js\n    2016-05-01\n\n    Public Domain.\n\n    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n    This code should be minified before deployment.\n    See http://javascript.crockford.com/jsmin.html\n\n    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n    NOT CONTROL.\n*/\n\n/*jslint eval, for */\n\n/*property\n    $ref, decycle, forEach, isArray, keys, length, push, retrocycle, stringify,\n    test\n*/\n\nlet origJSON = global.JSON,\n    JSON = {}\nmodule.exports = JSON\n\nif (typeof JSON.decycle !== \"function\") {\n    JSON.decycle = function decycle(object, replacer) {\n        \"use strict\";\n\n// Make a deep copy of an object or array, assuring that there is at most\n// one instance of each object or array in the resulting structure. The\n// duplicate references (which might be forming cycles) are replaced with\n// an object of the form\n\n//      {\"$ref\": PATH}\n\n// where the PATH is a JSONPath string that locates the first occurance.\n\n// So,\n\n//      var a = [];\n//      a[0] = a;\n//      return JSON.stringify(JSON.decycle(a));\n\n// produces the string '[{\"$ref\":\"$\"}]'.\n\n// If a replacer function is provided, then it will be called for each value.\n// A replacer function receives a value and returns a replacement value.\n\n// JSONPath is used to locate the unique object. $ indicates the top level of\n// the object or array. [NUMBER] or [STRING] indicates a child element or\n// property.\n\n        var objects = [];   // Keep a reference to each unique object or array\n        var paths = [];     // Keep the path to each unique object or array\n\n        return (function derez(value, path) {\n\n// The derez function recurses through the object, producing the deep copy.\n\n            var i;          // The loop counter\n            var nu;         // The new object or array\n\n// If a replacer function was provided, then call it to get a replacement value.\n\n            if (replacer !== undefined) {\n                value = replacer(value);\n            }\n\n// typeof null === \"object\", so go on if this value is really an object but not\n// one of the weird builtin objects.\n\n            if (\n                typeof value === \"object\" && value !== null &&\n                !(value instanceof Boolean) &&\n                !(value instanceof Date) &&\n                !(value instanceof Number) &&\n                !(value instanceof RegExp) &&\n                !(value instanceof String)\n            ) {\n\n// If the value is an object or array, look to see if we have already\n// encountered it. If so, return a {\"$ref\":PATH} object. This is a hard\n// linear search that will get slower as the number of unique objects grows.\n// Someday, this should be replaced with an ES6 WeakMap.\n\n                i = objects.indexOf(value);\n                if (i >= 0) {\n                    return {$ref: paths[i]};\n                }\n\n// Otherwise, accumulate the unique value and its path.\n\n                objects.push(value);\n                paths.push(path);\n\n// If it is an array, replicate the array.\n\n                if (Array.isArray(value)) {\n                    nu = [];\n                    value.forEach(function (element, i) {\n                        nu[i] = derez(element, path + \"[\" + i + \"]\");\n                    });\n                } else {\n\n// If it is an object, replicate the object.\n\n                    nu = {};\n                    Object.keys(value).forEach(function (name) {\n                        nu[name] = derez(\n                            value[name],\n                            path + \"[\" + JSON.stringify(name) + \"]\"\n                        );\n                    });\n                }\n                return nu;\n            }\n            return value;\n        }(object, \"$\"));\n    };\n}\n\n\nif (typeof JSON.retrocycle !== \"function\") {\n    JSON.retrocycle = function retrocycle($) {\n        \"use strict\";\n\n// Restore an object that was reduced by decycle. Members whose values are\n// objects of the form\n//      {$ref: PATH}\n// are replaced with references to the value found by the PATH. This will\n// restore cycles. The object will be mutated.\n\n// The eval function is used to locate the values described by a PATH. The\n// root object is kept in a $ variable. A regular expression is used to\n// assure that the PATH is extremely well formed. The regexp contains nested\n// * quantifiers. That has been known to have extremely bad performance\n// problems on some browsers for very long strings. A PATH is expected to be\n// reasonably short. A PATH is allowed to belong to a very restricted subset of\n// Goessner's JSONPath.\n\n// So,\n//      var s = '[{\"$ref\":\"$\"}]';\n//      return JSON.retrocycle(JSON.parse(s));\n// produces an array containing a single element which is the array itself.\n\n        var px = /^\\$(?:\\[(?:\\d+|\\\"(?:[^\\\\\\\"\\u0000-\\u001f]|\\\\([\\\\\\\"\\/bfnrt]|u[0-9a-zA-Z]{4}))*\\\")\\])*$/;\n\n        (function rez(value) {\n\n// The rez function walks recursively through the object looking for $ref\n// properties. When it finds one that has a value that is a path, then it\n// replaces the $ref object with a reference to the value that is found by\n// the path.\n\n            if (value && typeof value === \"object\") {\n                if (Array.isArray(value)) {\n                    value.forEach(function (element, i) {\n                        if (typeof element === \"object\" && element !== null) {\n                            var path = element.$ref;\n                            if (typeof path === \"string\" && px.test(path)) {\n                                value[i] = eval(path);\n                            } else {\n                                rez(element);\n                            }\n                        }\n                    });\n                } else {\n                    Object.keys(value).forEach(function (name) {\n                        var item = value[name];\n                        if (typeof item === \"object\" && item !== null) {\n                            var path = item.$ref;\n                            if (typeof path === \"string\" && px.test(path)) {\n                                value[name] = eval(path);\n                            } else {\n                                rez(item);\n                            }\n                        }\n                    });\n                }\n            }\n        }($));\n        return $;\n    };\n}\n\nJSON = origJSON\n\n\n/** WEBPACK FOOTER **\n ** ./lib/cycle.js\n **/","module.exports = require(\"babel-runtime/core-js/object/keys\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-runtime/core-js/object/keys\"\n ** module id = 8\n ** module chunks = 0\n **/","module.exports = require(\"babel-runtime/helpers/typeof\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-runtime/helpers/typeof\"\n ** module id = 9\n ** module chunks = 0\n **/","import utils from './utils'\n\nconst BUNYAN_TRACE = 10\nconst BUNYAN_DEBUG = 20\nconst BUNYAN_INFO = 30\nconst BUNYAN_WARN = 40\nconst BUNYAN_ERROR = 50\nconst BUNYAN_FATAL = 60\n\nlet levelFromName = {\n      'trace': BUNYAN_TRACE,\n      'debug': BUNYAN_DEBUG,\n      'info': BUNYAN_INFO,\n      'warn': BUNYAN_WARN,\n      'error': BUNYAN_ERROR,\n      'fatal': BUNYAN_FATAL\n    },\n    nameFromLevel = utils.invert(levelFromName)\n\nexport default inst => {\n  return {\n    write: function(rec) {\n      // TODO: Look for the first call that didn't originate in bunyan.js\n      rec = JSON.parse(rec)\n      let src = rec.src\n      inst._sendMessage({\n        method: nameFromLevel[rec.level] || 'info',\n        args: [ rec.msg, rec ],\n        callerInfo: src && {\n          caller: src.func || 'anonymous',\n          file: src.file,\n          line: src.line,\n          column: 0\n        }\n      })\n    }\n  }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/bunyan-stream.js\n **/","import commonUtils from '../lib/common-utils'\n\nexport default Object.assign({\n  parseCommand(str) {\n    const reg = /\"(.*?)\"|'(.*?)'|`(.*?)`|([^\\s\"]+)/gi\n    let arr = [],\n        match\n\n    do {\n      match = reg.exec(str)\n      if (match !== null) {\n        arr.push(match[1] || match[2] || match[3] || match[4])\n      }\n    } while (match !== null)\n\n    return arr\n  }\n}, commonUtils)\n\n\n/** WEBPACK FOOTER **\n ** ./server/utils.js\n **/","module.exports = require(\"babel-runtime/core-js/object/assign\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-runtime/core-js/object/assign\"\n ** module id = 12\n ** module chunks = 0\n **/","module.exports = {\n  isObject(value) {\n    let type = typeof value\n    return !!value && (type == 'object' || type == 'function')\n  },\n\n  invert(obj) {\n    let inverted = {}\n    for (let k in obj) {\n      if (obj.hasOwnProperty(k)) {\n        inverted[obj[k]] = k\n      }\n    }\n\n    return inverted\n  }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./lib/common-utils.js\n **/","import restify from 'restify'\n\nexport default options => {\n  let server = restify.createServer()\n\n  server.pre(restify.pre.userAgentConnection())\n  server.use(restify.gzipResponse())\n  server.use(restify.CORS({\n    credentials: true\n  }))\n\n  server.get(/.*/, restify.serveStatic({\n    directory: __dirname,\n    default: 'index.html'\n  }))\n\n  return server\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/setup-server.js\n **/","module.exports = require(\"restify\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"restify\"\n ** module id = 15\n ** module chunks = 0\n **/","import _ from 'lodash'\nimport socketio from 'socket.io'\nimport CmdMan from './command-manager'\n\nexport default options => {\n  let io, ns\n  let userManager = options.userManager\n\n  if (typeof options.server === 'function') {\n    io = socketio(options.server)\n  } else {\n    io = socketio()\n    io.attach(options.server)\n  }\n\n  ns = io.of('/nm')\n  ns.on('connection', socket => {\n    socket.emit('settings', options.clientSettings)\n    socket.emit('auth')\n\n    socket.on('auth', creds => {\n      userManager.verifyUser(creds.username, creds.password).then(result => {\n        if (result) {\n          socket.username = creds.username\n          socket.join('authed')\n          if (options.onAuth) {\n            options.onAuth(socket)\n          }\n        } else {\n          socket.emit('auth')\n        }\n      }).catch(err => {\n        socket.emit('auth')\n      })\n    })\n\n    socket.on('cmd', (cmdId, command) => {\n      CmdMan.runCmd(command, socket.username)\n        .then(output => {\n          socket.emit('cmdResponse', cmdId, null, output)\n        }).catch(err => {\n          socket.emit('cmdResponse', cmdId, err && err.message || err, null)\n        })\n    })\n  })\n\n  _.each(options.handlers, function(handler, event) {\n    io.on(event, handler)\n  })\n\n  return ns\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/setup-socket.js\n **/","module.exports = require(\"socket.io\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"socket.io\"\n ** module id = 17\n ** module chunks = 0\n **/","import utils from './utils'\nimport minimist from 'minimist'\n\nfunction CommandManager() {\n  this.commands = {}\n}\n\nObject.assign(CommandManager.prototype, {\n  addCmd(cmdName, opts, exec) {\n    if (this.commands[cmdName]) {\n      throw new Error(`'${cmdName}' is already registered as a command`)\n    }\n\n    if (typeof opts === 'function') {\n      exec = opts\n      opts = {}\n    }\n\n    this.commands[cmdName] = {\n      opts,\n      exec\n    }\n  },\n\n  runCmd(rawCommand, asUser) {\n    return new Promise((resolve, reject) => {\n      let parsed = utils.parseCommand(rawCommand),\n          cmdName = parsed[0],\n          cmd = this.commands[cmdName]\n\n      if (!asUser) {\n        return reject(`Missing user context for command '${cmdName}'`)\n      }\n\n      if (!cmd) {\n        return reject(`Command not found: '${cmdName}'`)\n      }\n\n      let args = minimist(parsed.slice(1))\n      cmd.exec(args, resolve, reject, asUser)\n    })\n  }\n})\n\n\nexport default new CommandManager()\n\n\n/** WEBPACK FOOTER **\n ** ./server/command-manager.js\n **/","module.exports = require(\"babel-runtime/core-js/promise\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-runtime/core-js/promise\"\n ** module id = 19\n ** module chunks = 0\n **/","module.exports = require(\"minimist\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"minimist\"\n ** module id = 20\n ** module chunks = 0\n **/","import fs from 'fs'\nimport ssh2 from 'ssh2'\nimport termkit from 'terminal-kit'\nimport CmdMan from './command-manager'\n\nfunction SSHManager(options) {\n  this.options = options = Object.assign({\n    host: '127.0.0.1',\n    port: 50501,\n    title: 'Node Monkey',\n    prompt: 'Node Monkey:'\n  }, options)\n\n  this.clients = {}\n  this.clientId = 1\n\n  this.server = ssh2.Server({\n    hostKeys: options.hostKeys.map(file => {\n      return fs.readFileSync(file)\n    })\n  }, this.onClient.bind(this))\n\n  this.server.listen(options.port, options.host, function() {\n    console.log(`Listening on ${this.address().port}`)\n  })\n}\n\nObject.assign(SSHManager.prototype, {\n  shutdown() {\n    let clients = this.clients\n    for (let c of clients) {\n      c.write('\\nShutting down')\n      c.close()\n    }\n  },\n\n  onClient(client) {\n    let clientId = clientId++\n    this.clients[clientId] = new SSHClient({\n      client,\n      userManager: this.options.userManager,\n      title: this.options.title,\n      prompt: this.options.prompt,\n      onClose: () => delete this.clients[clientId]\n    })\n  }\n})\n\n\nfunction SSHClient(options) {\n  this.options = options\n  this.client = options.client\n  this.userManager = options.userManager\n  this.session = null\n  this.stream = null\n  this.term = null\n  this.ptyInfo = null\n\n  this.title = options.title\n  this.promptTxt = `${options.prompt} `\n  this.inputActive = false\n  this.cmdHistory = []\n\n  this.username = null\n\n  this.client.on('authentication', this.onAuth.bind(this))\n  this.client.on('ready', this.onReady.bind(this))\n  this.client.on('end', this.onClose.bind(this))\n}\n\nObject.assign(SSHClient.prototype, {\n  write(msg, opts) {\n    opts || (opts = {})\n    if (this.term) {\n      if (opts.style) {\n        this.term[style](msg)\n      } else {\n        this.term(msg)\n      }\n    }\n  },\n\n  close() {\n    if (this.stream) {\n      this.stream.end()\n    }\n    this.onClose()\n  },\n\n  onAuth(ctx) {\n    if (ctx.method == 'password') {\n      this.userManager.verifyUser(ctx.username, ctx.password).then(result => {\n        if (result) {\n          this.username = ctx.username\n          ctx.accept()\n        } else {\n          ctx.reject()\n        }\n      }).catch(err => {\n        ctx.reject()\n      })\n    } else if (ctx.method == 'publickey') {\n      ctx.reject()\n    } else {\n      ctx.reject()\n    }\n  },\n\n  onReady() {\n    this.client.on('session', (accept, reject) => {\n      this.session = accept()\n\n      this.session\n        .once('pty', (accept, reject, info) => {\n          this.ptyInfo = info\n          accept && accept()\n        })\n        .on('window-change', this.onWindowChange.bind(this))\n        .once('shell', (accept, reject) => {\n          this.stream = accept()\n          this._initStream()\n          this._initTerm()\n        })\n    })\n  },\n\n  onWindowChange(accept, reject, info) {\n    let stream = this.stream\n    Object.assign(this.ptyInfo, info)\n    if (stream) {\n      stream.rows = info.rows\n      stream.columns = info.cols\n      stream.emit('resize')\n    }\n    accept && accept()\n  },\n\n  onClose() {\n    let onClose = this.options.onClose\n    onClose && onClose()\n  },\n\n  onKey(name, matches, data) {\n    if (name === 'CTRL_L') {\n      this.clearScreen()\n    } else if (name === 'CTRL_D') {\n      this.term.nextLine()\n      this.close()\n    }\n  },\n\n  _initStream() {\n    let stream = this.stream\n    stream.name = this.title\n    stream.rows = this.ptyInfo.rows || 24\n    stream.columns = this.ptyInfo.cols || 80\n    stream.isTTY = true\n    stream.setRawMode = () => {}\n    stream.on('error', error => {\n      console.error('SSH stream error:', error.message)\n    })\n    stream.stdout.getWindowSize = () => {\n      return [ this.ptyInfo.cols, this.ptyInfo.rows ]\n    }\n  },\n\n  _initTerm() {\n    let stream = this.stream\n\n    let term = this.term = termkit.createTerminal({\n      stdin: stream.stdin,\n      stdout: stream.stdout,\n      stderr: stream.stderr,\n      generic: this.ptyInfo.term,\n      appName: this.title\n    })\n\n    term.on('key', this.onKey.bind(this))\n    term.windowTitle(this._interpolate(this.title))\n    this.clearScreen()\n  },\n\n  _interpolate(str) {\n    let varRe = /{@(.+?)}/g\n    let vars = {\n      username: this.username\n    }\n\n    let match\n    while(match = varRe.exec(str)) {\n      if (vars[match[1]]) {\n        str = str.replace(match[0], vars[match[1]])\n      }\n    }\n\n    return str\n  },\n\n  clearScreen() {\n    this.term.clear()\n    this.prompt()\n  },\n\n  prompt() {\n    let term = this.term\n    term.windowTitle(this._interpolate(this.title))\n    term.bold(this._interpolate(this.promptTxt))\n\n    if (!this.inputActive) {\n      this.inputActive = true\n      term.inputField({\n        history: this.cmdHistory,\n        autoComplete: Object.keys(CmdMan.commands),\n        autoCompleteMenu: true\n      }, (error, input) => {\n        this.inputActive = false\n        input[0] !== ' ' && this.cmdHistory.push(input)\n        term.nextLine()\n\n        if (input === 'exit') {\n          this.close()\n        } else if (input === 'clear') {\n          this.clearScreen()\n        } else if (input) {\n          CmdMan.runCmd(input, this.username)\n            .then(output => {\n              if (typeof output !== 'string') {\n                output = JSON.stringify(output, null, '  ')\n              }\n              this.term(output.replace(/(\\n+)/g, '\\r$1'))\n              this.term.nextLine()\n              this.prompt()\n            })\n            .catch(err => {\n              if (typeof err !== 'string') {\n                err = err.message || JSON.stringify(err, null, '  ')\n              }\n              this.term.red.error(err.replace(/(\\n+)/g, '\\r$1'))\n              this.term.nextLine()\n              this.prompt()\n            })\n        } else {\n          this.prompt()\n        }\n      })\n    }\n  }\n})\n\n\nexport default SSHManager\n\n\n\n// ssh2.Server({\n//   hostKeys: [\n//     fs.readFileSync(`${__dirname}/ssh/hostkey_rsa`),\n//     fs.readFileSync(`${__dirname}/ssh/hostkey_dsa`)\n//   ]\n// }, function(client) {\n//   client.on('authentication', function(ctx) {\n//     if (ctx.method == 'password') {\n//       if (ctx.username == 'guest' && ctx.password == 'guest') {\n//         ctx.accept()\n//       } else {\n//         ctx.reject()\n//       }\n//     } else if (ctx.method == 'publickey') {\n//       ctx.reject()\n//     } else {\n//       ctx.reject()\n//     }\n//   }).on('ready', function() {\n//     console.log('Client authenticated!')\n\n//     client.on('session', function(accept, reject) {\n//       let session = accept(),\n//           stream,title\n//           rows, cols, term,\n//           cmdHistory = []\n\n//       session.once('pty', function(accept, reject, info) {\n//         rows = info.rows\n//         cols = info.cols\n//         term = info.term\n//         accept && accept()\n//       }).on('window-change', function(accept, reject, info) {\n//         rows = info.rows\n//         cols = info.cols\n//         if (stream) {\n//           stream.rows = rows\n//           stream.columns = cols\n//           stream.emit('resize')\n//         }\n//         accept && accept()\n//       }).once('shell', function(accept, reject) {\n//         let title = `Node Monkey@${os.hostname()}`,\n//             promptTxt = `${title}: `\n\n//         stream = accept()\n//         stream.name = title\n//         stream.rows = rows || 24\n//         stream.columns = cols || 80\n//         stream.isTTY = true\n//         stream.setRawMode = () => {}\n//         stream.on('error', error => {\n//           console.error('SSH stream error:', error.message)\n//         })\n//         stream.stdout.getWindowSize = () => {\n//           return [ cols, rows ]\n//         }\n\n//         let terminal = termkit.createTerminal({\n//           stdin: stream.stdin,\n//           stdout: stream.stdout,\n//           stderr: stream.stderr,\n//           generic: term,\n//           appName: title\n//         })\n\n//         let inputActive = false\n//         function prompt() {\n//           terminal.bold(promptTxt)\n\n//           if (!inputActive) {\n//             inputActive = true\n//             terminal.inputField({\n//               history: cmdHistory\n//             }, (error, input) => {\n//               inputActive = false\n//               cmdHistory.push(input)\n//               terminal.nextLine()\n\n//               if (input === 'exit') {\n//                 stream.end()\n//               } else if (input === 'clear') {\n//                 clearScreen()\n//               } else if (input) {\n//                 let args = minimist(parseCommand(input).slice(1))\n//                 // Run command and wait for completion before prompt\n//                 prompt()\n//               } else {\n//                 prompt()\n//               }\n//             })\n//           }\n//         }\n\n//         function clearScreen() {\n//           terminal.clear()\n//           prompt()\n//         }\n\n//         terminal.on('key', (name, matches, data) => {\n//           if (name === 'CTRL_L') {\n//             clearScreen()\n//           } else if (name === 'CTRL_D') {\n//             terminal.nextLine()\n//             stream.end()\n//           }\n//         })\n\n//         terminal.windowTitle(title)\n//         clearScreen()\n//       })\n//     })\n//   }).on('end', function() {\n//     console.log('Client disconnected')\n//   })\n// }).listen(50501, '127.0.0.1', function() {\n//   console.log(`Listening on ${this.address().port}`)\n// })\n\n\n/** WEBPACK FOOTER **\n ** ./server/ssh-manager.js\n **/","module.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-runtime/core-js/json/stringify\"\n ** module id = 22\n ** module chunks = 0\n **/","module.exports = require(\"ssh2\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"ssh2\"\n ** module id = 23\n ** module chunks = 0\n **/","module.exports = require(\"terminal-kit\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"terminal-kit\"\n ** module id = 24\n ** module chunks = 0\n **/","import fs from 'fs'\nimport scrypt from 'scrypt'\n\nfunction UserManager(options) {\n  this.userFile = options.userFile\n  this.userFileCache = null\n  this.userFileCreated = false\n}\n\nObject.assign(UserManager.prototype, {\n  _readFile() {\n    if (this.userFileCache) {\n      return this.userFileCache\n    }\n\n    try {\n      this.userFileCache = JSON.parse(fs.readFileSync(this.userFile))\n      this.userFileCreated = true\n      setTimeout(() => { this.userFileCache = null }, 5000)\n\n      return this.userFileCache\n    } catch(err) {\n      if (err.code === 'ENOENT') {\n        return {\n          guest: {\n            password: 'c2NyeXB0AAEAAAABAAAAAZS+vE1+zh4nY6vN21zM3dIzpJVImr8OrK0iJoA+iUPk7WIdo3RhgeATzWENocd7gKNbEKVgq6LbXqrmVjLtnYy5FXyfRCtEtmjUuj19AqcW'\n          }\n        }\n      }\n      throw err\n    }\n  },\n\n  _writeFile(data) {\n    this.userFileCache = null\n    fs.writeFileSync(this.userFile, JSON.stringify(data, null, '  '))\n    this.userFileCreated = true\n  },\n\n  _hashPassword(passwd) {\n    return scrypt.kdfSync(passwd.normalize('NFKC'), { N: 1, r: 1, p: 1 }).toString('base64')\n  },\n\n  _verifyPassword(hash, passwd) {\n    return scrypt.verifyKdfSync(Buffer.from(hash, 'base64'), passwd.normalize('NFKC'))\n  },\n\n  createUser(username, password) {\n    return new Promise((resolve, reject) => {\n      if (!this.userFile) {\n        return reject(new Error(`No user file found. Did you forget to set the 'dataDir' option?`))\n      }\n\n      let users = this._readFile()\n      if (users[username]) {\n        return reject(new Error(`User '${username}' already exists`))\n      }\n\n      if (!this.userFileCreated) {\n        delete users['guest']\n      }\n\n      users[username] = {\n        password: this._hashPassword(password)\n      }\n      this._writeFile(users)\n      resolve()\n    })\n  },\n\n  setPassword(username, password) {\n    return new Promise((resolve, reject) => {\n      if (!this.userFile) {\n        return reject(new Error(`No user file found. Did you forget to set the 'dataDir' option?`))\n      }\n\n      let users = this._readFile()\n\n      users[username].password = this._hashPassword(password)\n      this._writeFile(users)\n      resolve()\n    })\n  },\n\n  getUsers() {\n    return new Promise((resolve, reject) => {\n      resolve(this._readFile())\n    })\n  },\n\n  getUserData(username) {\n    return new Promise((resolve, reject) => {\n      let users = this._readFile()\n      if (!users[username]) {\n        return reject(`User '${username}' does not exist`)\n      }\n\n      resolve(users[username])\n    })\n  },\n\n  verifyUser(username, passwd) {\n    return new Promise((resolve, reject) => {\n      this.getUserData(username).then(userData => {\n        resolve(this._verifyPassword(userData.password, passwd))\n      }).catch(reject)\n    })\n  }\n})\n\n\nexport default UserManager\n\n\n/** WEBPACK FOOTER **\n ** ./server/user-manager.js\n **/","module.exports = require(\"scrypt\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"scrypt\"\n ** module id = 26\n ** module chunks = 0\n **/"],"sourceRoot":""}