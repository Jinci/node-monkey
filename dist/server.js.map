{"version":3,"sources":["webpack:///server.js","webpack:///webpack/bootstrap a3db8a4a6a641e5224f1","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///./server/command-manager.js","webpack:///./server/utils.js","webpack:///external \"fs\"","webpack:///external \"lodash\"","webpack:///external \"babel-runtime/core-js/get-iterator\"","webpack:///external \"babel-runtime/core-js/json/stringify\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"babel-runtime/helpers/typeof\"","webpack:///./lib/cycle.js","webpack:///./server/bunyan-stream.js","webpack:///./server/setup-server.js","webpack:///./server/setup-socket.js","webpack:///./server/ssh-manager.js","webpack:///./server/user-manager.js","webpack:///external \"child_process\"","webpack:///external \"events\"","webpack:///external \"keypair\"","webpack:///external \"os\"","webpack:///external \"path\"","webpack:///./lib/common-utils.js","webpack:///./server/app.js","webpack:///external \"minimist\"","webpack:///external \"pty.js\"","webpack:///external \"restify\"","webpack:///external \"scrypt\"","webpack:///external \"socket.io\"","webpack:///external \"source-map-support\"","webpack:///external \"ssh2\"","webpack:///external \"terminal-kit\"","webpack:///external \"tty\""],"names":["require","install","module","exports","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_interopRequireDefault","obj","default","CommandManager","this","commands","_promise","_promise2","_assign","_assign2","_lodash","_lodash2","_utils","_utils2","_minimist","_minimist2","addCmd","cmdName","opts","exec","Error","bindI","ioInterface","_this","boundI","mapValues","constructor","val","key","Function","bind","runCmd","io","rawCommand","asUser","_this2","resolve","reject","parsed","parseCommand","cmd","args","slice","username","write","writeLn","error","prompt","_commonUtils","_commonUtils2","_sourceMapSupport","_sourceMapSupport2","str","reg","arr","match","push","getStack","prep","prepareStackTrace","limit","stackTraceLimit","trace","map","wrapCallSite","stack","_keys","_keys2","_typeof2","_typeof3","origJSON","global","JSON","decycle","replacer","objects","paths","derez","path","nu","undefined","Boolean","Date","Number","RegExp","String","indexOf","$ref","Array","isArray","forEach","element","stringify","retrocycle","$","px","rez","test","eval","item","levelFromName","debug","info","warn","fatal","nameFromLevel","invert","inst","rec","parse","_sendMessage","method","level","msg","_restify","_restify2","options","server","createServer","pre","userAgentConnection","use","gzipResponse","CORS","credentials","serveStatic","directory","__dirname","createCmdMan","socket","promptId","prompts","cmdManOpts","emit","promptTxt","cb","pid","on","response","_commandManager2","_socket","_socket2","_commandManager","ns","userManager","attach","of","cmdMan","clientSettings","creds","verifyUser","password","then","result","join","onAuth","catch","err","cmdId","command","output","message","each","handlers","handler","event","SSHManager","host","port","title","silent","clients","clientId","_ssh2","Server","hostKeys","file","_fs2","readFileSync","onClient","monkey","listen","local","log","address","SSHClient","client","session","stream","pty","term","ptyInfo","inputActive","cmdHistory","onReady","onClose","_stringify","_stringify2","_getIterator2","_getIterator3","_fs","_tty","_tty2","_pty","_pty2","_ssh","_terminalKit","_terminalKit2","shutdown","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","next","done","close","return","cmdManager","_initCmdMan","bold","newline","nextLine","red","arguments","length","inputOpts","hideInput","echo","inputField","style","end","ctx","_this3","accept","_this4","once","_resize","_initStream","_initPty","_initTerm","onKey","matches","data","_this5","clearScreen","abort","input","getInput","setTimeout","stdout","isTTY","setRawMode","console","_this6","newPty","native","open","cols","rows","master_fd","master","slave_fd","slave","WriteStream","ReadStream","getWindowSize","stdin","pipe","createTerminal","stderr","generic","appName","windowTitle","_interpolate","varRe","vars","replace","clear","_this7","history","autoComplete","autoCompleteMenu","stringToBuffer","string","base","useNew","Buffer","from","UserManager","userFile","userFileCache","userFileCreated","getUsers","users","usernames","process","env","NODE_ENV","_scrypt","_scrypt2","_readFile","code","guest","_writeFile","writeFileSync","_hashPassword","passwd","kdfSync","normalize","N","r","toString","_verifyPassword","hash","verifyKdfSync","createUser","deleteUser","setPassword","getUserData","userData","isObject","type","inverted","k","NodeMonkey","warnConsole","warned","warningMsg","self","remote","merge","DEFAULT_PORT","bufferSize","attachOnStart","disableLocalOutput","showCallerInfo","convertStyles","ssh","enabled","_os2","hostname","dataDir","msgBuffer","BUNYAN_STREAM","_bunyanStream2","_attached","_typeHandlers","_createLocal","_createRemote","_setupCmdMan","_setupUserManager","_setupServer","_setupSSH","attachConsole","fn","localFn","apply","remoteFn","callerStackDistance","_os","_path","_path2","_events","_events2","_keypair","_keypair2","_cycle","_cycle2","_bunyanStream","_setupServer2","_setupServer3","_setupSocket","_setupSocket2","_sshManager","_sshManager2","_userManager","_userManager2","CONSOLE","ConsoleEvent","HANDLE_TYPES","attachedCount","assign","_getServerProtocol","tlsClientError","getServerPaths","basePath","index","_displayServerWelcome","listening","proto","_server$address","_cmdMan","userMan","_","passwordAgain","user","curpwd","serverApp","_options$server","remoteClients","_sendMessages","sshOpts","files","readdirSync","keyRe","keys","private","public","SSHMan","_getCallerInfo","frame","functionName","getFunctionName","methodName","getMethodName","fileName","getFileName","lineNumber","getLineNumber","columnNumber","getColumnNumber","caller","find","twoBack","sixBack","line","column","callerInfo","shift","size","adapter","rooms","to","handlersActive","concat","serverOptions","detachConsole","removeListener","instances","lastPort","set"],"mappings":"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","file":"server.js","sourcesContent":["require(\"source-map-support\").install();\nmodule.exports = \n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 22);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"babel-runtime/core-js/object/assign\");\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"babel-runtime/core-js/object/keys\");\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(exports,\"__esModule\",{value:true});var _promise=__webpack_require__(8);var _promise2=_interopRequireDefault(_promise);var _assign=__webpack_require__(0);var _assign2=_interopRequireDefault(_assign);var _lodash=__webpack_require__(5);var _lodash2=_interopRequireDefault(_lodash);var _utils=__webpack_require__(3);var _utils2=_interopRequireDefault(_utils);var _minimist=__webpack_require__(23);var _minimist2=_interopRequireDefault(_minimist);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function CommandManager(){this.commands={};}(0,_assign2.default)(CommandManager.prototype,{addCmd:function addCmd(cmdName,opts,exec){if(this.commands[cmdName]){throw new Error('\\''+cmdName+'\\' is already registered as a command');}if(typeof opts==='function'){exec=opts;opts={};}this.commands[cmdName]={opts:opts,exec:exec};},bindI:function bindI(ioInterface){var _this=this;var boundI=_lodash2.default.mapValues(this);(0,_assign2.default)(boundI,_lodash2.default.mapValues(this.constructor.prototype,function(val,key){if(val instanceof Function){if(key==='runCmd'){return val.bind(_this,ioInterface);}return val.bind(_this);}else{return val;}}));return boundI;},runCmd:function runCmd(io,rawCommand,asUser){var _this2=this;return new _promise2.default(function(resolve,reject){var parsed=_utils2.default.parseCommand(rawCommand),cmdName=parsed[0],cmd=_this2.commands[cmdName];if(!asUser){return reject('Missing user context for command \\''+cmdName+'\\'');}if(!cmd){return reject('Command not found: \\''+cmdName+'\\'');}var args=(0,_minimist2.default)(parsed.slice(1));cmd.exec({args:args,username:asUser},{write:io.write,writeLn:io.writeLn,error:io.error,prompt:io.prompt},resolve);});}});exports.default=CommandManager;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(exports,\"__esModule\",{value:true});var _assign=__webpack_require__(0);var _assign2=_interopRequireDefault(_assign);var _commonUtils=__webpack_require__(21);var _commonUtils2=_interopRequireDefault(_commonUtils);var _sourceMapSupport=__webpack_require__(28);var _sourceMapSupport2=_interopRequireDefault(_sourceMapSupport);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}exports.default=(0,_assign2.default)({parseCommand:function parseCommand(str){var reg=/\"(.*?)\"|'(.*?)'|`(.*?)`|([^\\s\"]+)/gi;var arr=[],match=void 0;do{match=reg.exec(str);if(match!==null){arr.push(match[1]||match[2]||match[3]||match[4]);}}while(match!==null);return arr;},getStack:function getStack(){var prep=Error.prepareStackTrace;var limit=Error.stackTraceLimit;Error.prepareStackTrace=function(error,trace){return trace.map(_sourceMapSupport2.default.wrapCallSite);};Error.stackTraceLimit=30;var stack=new Error().stack;Error.prepareStackTrace=prep;Error.stackTraceLimit=limit;return stack.slice(1);}},_commonUtils2.default);\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"fs\");\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"lodash\");\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"babel-runtime/core-js/get-iterator\");\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"babel-runtime/core-js/promise\");\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"babel-runtime/helpers/typeof\");\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nvar _keys=__webpack_require__(1);var _keys2=_interopRequireDefault(_keys);var _typeof2=__webpack_require__(9);var _typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}/*\n    cycle.js\n    2016-05-01\n\n    Public Domain.\n\n    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n    This code should be minified before deployment.\n    See http://javascript.crockford.com/jsmin.html\n\n    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n    NOT CONTROL.\n*//*jslint eval, for *//*property\n    $ref, decycle, forEach, isArray, keys, length, push, retrocycle, stringify,\n    test\n*/var origJSON=global.JSON,JSON={};module.exports=JSON;if(typeof JSON.decycle!==\"function\"){JSON.decycle=function decycle(object,replacer){\"use strict\";// Make a deep copy of an object or array, assuring that there is at most\n// one instance of each object or array in the resulting structure. The\n// duplicate references (which might be forming cycles) are replaced with\n// an object of the form\n//      {\"$ref\": PATH}\n// where the PATH is a JSONPath string that locates the first occurance.\n// So,\n//      var a = [];\n//      a[0] = a;\n//      return JSON.stringify(JSON.decycle(a));\n// produces the string '[{\"$ref\":\"$\"}]'.\n// If a replacer function is provided, then it will be called for each value.\n// A replacer function receives a value and returns a replacement value.\n// JSONPath is used to locate the unique object. $ indicates the top level of\n// the object or array. [NUMBER] or [STRING] indicates a child element or\n// property.\nvar objects=[];// Keep a reference to each unique object or array\nvar paths=[];// Keep the path to each unique object or array\nreturn function derez(value,path){// The derez function recurses through the object, producing the deep copy.\nvar i;// The loop counter\nvar nu;// The new object or array\n// If a replacer function was provided, then call it to get a replacement value.\nif(replacer!==undefined){value=replacer(value);}// typeof null === \"object\", so go on if this value is really an object but not\n// one of the weird builtin objects.\nif((typeof value===\"undefined\"?\"undefined\":(0,_typeof3.default)(value))===\"object\"&&value!==null&&!(value instanceof Boolean)&&!(value instanceof Date)&&!(value instanceof Number)&&!(value instanceof RegExp)&&!(value instanceof String)){// If the value is an object or array, look to see if we have already\n// encountered it. If so, return a {\"$ref\":PATH} object. This is a hard\n// linear search that will get slower as the number of unique objects grows.\n// Someday, this should be replaced with an ES6 WeakMap.\ni=objects.indexOf(value);if(i>=0){return{$ref:paths[i]};}// Otherwise, accumulate the unique value and its path.\nobjects.push(value);paths.push(path);// If it is an array, replicate the array.\nif(Array.isArray(value)){nu=[];value.forEach(function(element,i){nu[i]=derez(element,path+\"[\"+i+\"]\");});}else{// If it is an object, replicate the object.\nnu={};(0,_keys2.default)(value).forEach(function(name){nu[name]=derez(value[name],path+\"[\"+JSON.stringify(name)+\"]\");});}return nu;}return value;}(object,\"$\");};}if(typeof JSON.retrocycle!==\"function\"){JSON.retrocycle=function retrocycle($){\"use strict\";// Restore an object that was reduced by decycle. Members whose values are\n// objects of the form\n//      {$ref: PATH}\n// are replaced with references to the value found by the PATH. This will\n// restore cycles. The object will be mutated.\n// The eval function is used to locate the values described by a PATH. The\n// root object is kept in a $ variable. A regular expression is used to\n// assure that the PATH is extremely well formed. The regexp contains nested\n// * quantifiers. That has been known to have extremely bad performance\n// problems on some browsers for very long strings. A PATH is expected to be\n// reasonably short. A PATH is allowed to belong to a very restricted subset of\n// Goessner's JSONPath.\n// So,\n//      var s = '[{\"$ref\":\"$\"}]';\n//      return JSON.retrocycle(JSON.parse(s));\n// produces an array containing a single element which is the array itself.\nvar px=/^\\$(?:\\[(?:\\d+|\\\"(?:[^\\\\\\\"\\u0000-\\u001f]|\\\\([\\\\\\\"\\/bfnrt]|u[0-9a-zA-Z]{4}))*\\\")\\])*$/;(function rez(value){// The rez function walks recursively through the object looking for $ref\n// properties. When it finds one that has a value that is a path, then it\n// replaces the $ref object with a reference to the value that is found by\n// the path.\nif(value&&(typeof value===\"undefined\"?\"undefined\":(0,_typeof3.default)(value))===\"object\"){if(Array.isArray(value)){value.forEach(function(element,i){if((typeof element===\"undefined\"?\"undefined\":(0,_typeof3.default)(element))===\"object\"&&element!==null){var path=element.$ref;if(typeof path===\"string\"&&px.test(path)){value[i]=eval(path);}else{rez(element);}}});}else{(0,_keys2.default)(value).forEach(function(name){var item=value[name];if((typeof item===\"undefined\"?\"undefined\":(0,_typeof3.default)(item))===\"object\"&&item!==null){var path=item.$ref;if(typeof path===\"string\"&&px.test(path)){value[name]=eval(path);}else{rez(item);}}});}}})($);return $;};}JSON=origJSON;\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(exports,\"__esModule\",{value:true});var _utils=__webpack_require__(3);var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var BUNYAN_TRACE=10;var BUNYAN_DEBUG=20;var BUNYAN_INFO=30;var BUNYAN_WARN=40;var BUNYAN_ERROR=50;var BUNYAN_FATAL=60;var levelFromName={'trace':BUNYAN_TRACE,'debug':BUNYAN_DEBUG,'info':BUNYAN_INFO,'warn':BUNYAN_WARN,'error':BUNYAN_ERROR,'fatal':BUNYAN_FATAL};var nameFromLevel=_utils2.default.invert(levelFromName);exports.default=function(inst){return{write:function write(rec){rec=JSON.parse(rec);inst._sendMessage({method:nameFromLevel[rec.level]||'info',args:[rec.msg,rec]});}};};\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(exports,\"__esModule\",{value:true});var _restify=__webpack_require__(25);var _restify2=_interopRequireDefault(_restify);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}exports.default=function(options){var server=_restify2.default.createServer();server.pre(_restify2.default.pre.userAgentConnection());server.use(_restify2.default.gzipResponse());server.use(_restify2.default.CORS({credentials:true}));server.get(/.*/,_restify2.default.serveStatic({directory:__dirname,default:'index.html'}));return server;};\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(exports,\"__esModule\",{value:true});var _lodash=__webpack_require__(5);var _lodash2=_interopRequireDefault(_lodash);var _socket=__webpack_require__(27);var _socket2=_interopRequireDefault(_socket);var _commandManager=__webpack_require__(2);var _commandManager2=_interopRequireDefault(_commandManager);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}exports.default=function(options){var io=void 0,ns=void 0;var userManager=options.userManager;if(typeof options.server==='function'){io=(0,_socket2.default)(options.server);}else{io=(0,_socket2.default)();io.attach(options.server);}ns=io.of('/nm');ns.on('connection',function(socket){var cmdMan=null;socket.emit('settings',options.clientSettings);socket.emit('auth');socket.on('auth',function(creds){userManager.verifyUser(creds.username,creds.password).then(function(result){socket.emit('authResponse',result,result?undefined:'Incorrect password');if(result){socket.username=creds.username;socket.join('authed');if(options.onAuth){options.onAuth(socket);}}}).catch(function(err){socket.emit('authResponse',false,err);});});socket.on('cmd',function(cmdId,command){if(!socket.username){socket.emit('cmdResponse',cmdId,'You are not authorized to run commands');return;}if(!cmdMan){cmdMan=createCmdMan(socket);}cmdMan.runCmd(command,socket.username).then(function(output){socket.emit('cmdResponse',cmdId,null,output);}).catch(function(err){socket.emit('cmdResponse',cmdId,err&&err.message||err,null);});});});_lodash2.default.each(options.handlers,function(handler,event){io.on(event,handler);});return ns;};function createCmdMan(socket){var promptId=0,prompts={};var cmdManOpts={writeLn:null,write:function write(val,opts){if(!val)return;socket.emit('console',{method:'log',args:[val]});},error:function error(val,opts){if(!val)return;socket.emit('console',{method:'error',args:[val]});},prompt:function prompt(promptTxt,opts,cb){if(typeof opts==='function'){cb=opts;opts=undefined;}opts||(opts={});var pid=promptId++;socket.emit('prompt',pid,promptTxt,opts);prompts[pid]=cb;}};cmdManOpts.writeLn=cmdManOpts.write;socket.on('promptResponse',function(promptId,response){if(prompts[promptId]){prompts[promptId](null,response);}});return new _commandManager2.default(cmdManOpts);}\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(exports,\"__esModule\",{value:true});var _stringify=__webpack_require__(7);var _stringify2=_interopRequireDefault(_stringify);var _keys=__webpack_require__(1);var _keys2=_interopRequireDefault(_keys);var _getIterator2=__webpack_require__(6);var _getIterator3=_interopRequireDefault(_getIterator2);var _assign=__webpack_require__(0);var _assign2=_interopRequireDefault(_assign);var _fs=__webpack_require__(4);var _fs2=_interopRequireDefault(_fs);var _tty=__webpack_require__(31);var _tty2=_interopRequireDefault(_tty);var _pty=__webpack_require__(24);var _pty2=_interopRequireDefault(_pty);var _ssh=__webpack_require__(29);var _ssh2=_interopRequireDefault(_ssh);var _terminalKit=__webpack_require__(30);var _terminalKit2=_interopRequireDefault(_terminalKit);var _commandManager=__webpack_require__(2);var _commandManager2=_interopRequireDefault(_commandManager);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function SSHManager(options){this.options=options=(0,_assign2.default)({host:'127.0.0.1',port:50501,title:'Node Monkey',prompt:'Node Monkey:',silent:false},options);this.clients={};this.clientId=1;this.server=_ssh2.default.Server({hostKeys:options.hostKeys.map(function(file){return _fs2.default.readFileSync(file);})},this.onClient.bind(this));var monkey=this.options.monkey;this.server.listen(options.port,options.host,function(){options.silent||monkey.local.log('SSH listening on '+this.address().port);});}(0,_assign2.default)(SSHManager.prototype,{shutdown:function shutdown(){var clients=this.clients;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=(0,_getIterator3.default)(clients),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var c=_step.value;c.write('\\nShutting down');c.close();}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}},onClient:function onClient(client){var _this=this;var clientId=clientId++;this.clients[clientId]=new SSHClient({client:client,cmdManager:this.options.cmdManager,userManager:this.options.userManager,title:this.options.title,prompt:this.options.prompt,onClose:function onClose(){return delete _this.clients[clientId];}});}});function SSHClient(options){this.options=options;this.client=options.client;this.cmdMan=null;this.userManager=options.userManager;this.session=null;this.stream=null;this.pty=null;this.term=null;this.ptyInfo=null;this.title=options.title;this.promptTxt=options.prompt+' ';this.inputActive=false;this.cmdHistory=[];this.username=null;this.client.on('authentication',this.onAuth.bind(this));this.client.on('ready',this.onReady.bind(this));this.client.on('end',this.onClose.bind(this));}(0,_assign2.default)(SSHClient.prototype,{_initCmdMan:function _initCmdMan(){var _this2=this;var cmdManOpts={writeLn:null,write:function write(val,opts){opts||(opts={});val||(val='');if(opts.bold){_this2.term.bold(val);}else{_this2.term(val);}if(opts.newline){_this2.term.nextLine();}},error:function error(val,opts){opts||(opts={});// TODO: Apparently by sending this to stdout there is a timing issue and anything sent to\n//       stdout appears before this value is sent to stderr for some reason.\n// this.term.red.error(val)\n_this2.term.red(val);if(opts.newline){_this2.term.nextLine();}},prompt:function prompt(){var promptTxt=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var opts=arguments[1];var cb=arguments[2];if(typeof opts==='function'){cb=opts;opts=undefined;}opts||(opts={});var inputOpts={};if(opts.hideInput){inputOpts.echo=false;}_this2.term(promptTxt);_this2.term.inputField(inputOpts,cb);}};cmdManOpts.writeLn=function(val,opts){opts||(opts={});opts.newline=true;cmdManOpts.write(val,opts);};this.cmdMan=this.options.cmdManager.bindI(cmdManOpts);},write:function write(msg,opts){opts||(opts={});if(this.term){if(opts.style){this.term[style](msg);}else{this.term(msg);}}},close:function close(){if(this.stream){this.stream.end();}this.onClose();},onAuth:function onAuth(ctx){var _this3=this;if(ctx.method=='password'){this.userManager.verifyUser(ctx.username,ctx.password).then(function(result){if(result){_this3.username=ctx.username;ctx.accept();}else{ctx.reject();}}).catch(function(err){ctx.reject();});}else if(ctx.method=='publickey'){ctx.reject();}else{ctx.reject();}},onReady:function onReady(){var _this4=this;this.client.on('session',function(accept,reject){_this4.session=accept();_this4.session.once('pty',function(accept,reject,info){_this4.ptyInfo=info;accept&&accept();}).on('window-change',function(accept,reject,info){(0,_assign2.default)(_this4.ptyInfo,info);_this4._resize();accept&&accept();}).once('shell',function(accept,reject){_this4.stream=accept();_this4._initCmdMan();_this4._initStream();_this4._initPty();_this4._initTerm();});});},onClose:function onClose(){var onClose=this.options.onClose;onClose&&onClose();},onKey:function onKey(name,matches,data){var _this5=this;if(name==='CTRL_L'){this.clearScreen();}else if(name==='CTRL_C'){this.inputActive=false;this.inputField.abort();this.term('\\n^^C\\n');this.prompt();}else if(name==='CTRL_D'){var input=this.inputField.getInput();if(!input.length){this.term.nextLine();setTimeout(function(){_this5.close();},0);}}},_resize:function _resize(){var term=this.term;if(this.term){this.term.stdout.emit('resize');}},_initStream:function _initStream(){var stream=this.stream;stream.name=this.title;stream.isTTY=true;stream.setRawMode=function(){};stream.on('error',function(error){console.error('SSH stream error:',error.message);});},_initPty:function _initPty(){var _this6=this;var newPty=_pty2.default.native.open(this.ptyInfo.cols,this.ptyInfo.rows);this.pty={master_fd:newPty.master,slave_fd:newPty.slave,master:new _tty2.default.WriteStream(newPty.master),slave:new _tty2.default.ReadStream(newPty.slave)};this.pty.slave.getWindowSize=function(){return[_this6.ptyInfo.cols,_this6.ptyInfo.rows];};this.stream.stdin.pipe(this.pty.master);this.pty.master.pipe(this.stream.stdout);},_initTerm:function _initTerm(){var stream=this.stream;var term=this.term=_terminalKit2.default.createTerminal({stdin:this.pty.slave,stdout:this.pty.slave,stderr:this.pty.slave,generic:this.ptyInfo.term,appName:this.title});term.on('key',this.onKey.bind(this));term.windowTitle(this._interpolate(this.title));this.clearScreen();},_interpolate:function _interpolate(str){var varRe=/{@(.+?)}/g;var vars={username:this.username};var match=void 0;while(match=varRe.exec(str)){if(vars[match[1]]){str=str.replace(match[0],vars[match[1]]);}}return str;},clearScreen:function clearScreen(){this.term.clear();this.prompt();},prompt:function prompt(){var _this7=this;var term=this.term;term.windowTitle(this._interpolate(this.title));term.bold(this._interpolate(this.promptTxt));if(!this.inputActive){this.inputActive=true;this.inputField=term.inputField({history:this.cmdHistory,autoComplete:(0,_keys2.default)(this.cmdMan.commands),autoCompleteMenu:true},function(error,input){_this7.inputActive=false;term.nextLine();if(error){return term.error(error.message||error);}if(!input){return _this7.prompt();}input[0]!==' '&&_this7.cmdHistory.push(input);if(input==='exit'){// This is delayed briefly so the newline can be echoed to the client, creating cleaner output when exiting\nsetTimeout(_this7.close.bind(_this7));}else if(input==='clear'){_this7.clearScreen();}else if(input){_this7.cmdMan.runCmd(input,_this7.username).then(function(output){if(typeof output!=='string'){output=(0,_stringify2.default)(output,null,'  ');}_this7.term(output);_this7.term.nextLine();_this7.prompt();}).catch(function(err){if(typeof err!=='string'){err=err.message||(0,_stringify2.default)(err,null,'  ');}_this7.term.red.error(err);_this7.term.nextLine();_this7.prompt();});}else{_this7.prompt();}});}}});exports.default=SSHManager;\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(exports,\"__esModule\",{value:true});var _promise=__webpack_require__(8);var _promise2=_interopRequireDefault(_promise);var _stringify=__webpack_require__(7);var _stringify2=_interopRequireDefault(_stringify);var _assign=__webpack_require__(0);var _assign2=_interopRequireDefault(_assign);var _keys=__webpack_require__(1);var _keys2=_interopRequireDefault(_keys);var _fs=__webpack_require__(4);var _fs2=_interopRequireDefault(_fs);var _scrypt=__webpack_require__(26);var _scrypt2=_interopRequireDefault(_scrypt);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var useNew=false;try{Buffer.from('','base64');}catch(err){useNew=true;}function stringToBuffer(string,base){if(useNew){return new Buffer(string,base);}else{return Buffer.from(string,base);}}function UserManager(options){this.userFile=options.userFile;this.userFileCache=null;this.userFileCreated=false;if(!options.silent){this.getUsers().then(function(users){var usernames=(0,_keys2.default)(users);if(!usernames.length){if(process.env.NODE_ENV==='production'){console.warn('No users have been created and you are running in production mode so you will not be able to login.\\n');}else{console.warn('It seems there are no users and you are not running in production mode so you will not be able to login. This is probably a bug. Please report it!\\n');}}else if(usernames.length===1&&usernames[0]==='guest'){console.warn('[WARN] No users detected. You can login with default user \\'guest\\' and password \\'guest\\' when prompted.\\n'+'This user will be disabled when you create a user account.\\n');}});}}(0,_assign2.default)(UserManager.prototype,{_readFile:function _readFile(){var _this=this;if(this.userFileCache){return this.userFileCache;}try{if(!this.userFile){var err=new Error('No user file specified');err.code='ENOENT';throw err;}this.userFileCache=JSON.parse(_fs2.default.readFileSync(this.userFile));this.userFileCreated=true;setTimeout(function(){_this.userFileCache=null;},5000);return this.userFileCache;}catch(err){if(err.code==='ENOENT'){return process.env.NODE_ENV==='production'?{}:{guest:{password:'c2NyeXB0AAEAAAABAAAAAZS+vE1+zh4nY6vN21zM3dIzpJVImr8OrK0iJoA+iUPk7WIdo3RhgeATzWENocd7gKNbEKVgq6LbXqrmVjLtnYy5FXyfRCtEtmjUuj19AqcW'}};}throw err;}},_writeFile:function _writeFile(data){this.userFileCache=null;_fs2.default.writeFileSync(this.userFile,(0,_stringify2.default)(data,null,'  '));this.userFileCreated=true;},_hashPassword:function _hashPassword(passwd){return _scrypt2.default.kdfSync(passwd.normalize('NFKC'),{N:1,r:1,p:1}).toString('base64');},_verifyPassword:function _verifyPassword(hash,passwd){return _scrypt2.default.verifyKdfSync(stringToBuffer(hash,'base64'),passwd.normalize('NFKC'));},createUser:function createUser(username,password){var _this2=this;return new _promise2.default(function(resolve,reject){if(!_this2.userFile){return reject(new Error('No user file found. Did you forget to set the \\'dataDir\\' option?'));}var users=_this2._readFile();if(users[username]){return reject(new Error('User \\''+username+'\\' already exists'));}if(!_this2.userFileCreated){delete users['guest'];}users[username]={password:_this2._hashPassword(password)};_this2._writeFile(users);resolve();});},deleteUser:function deleteUser(username){var _this3=this;return new _promise2.default(function(resolve,reject){if(!_this3.userFile){return reject(new Error('No user file found. Did you forget to set the \\'dataDir\\' option?'));}var users=_this3._readFile();if(!users[username]){return reject(new Error('User \\''+username+'\\' does not exist'));}if(!_this3.userFileCreated){return reject(new Error('User file has not been created'));}delete users[username];_this3._writeFile(users);resolve();});},setPassword:function setPassword(username,password){var _this4=this;return new _promise2.default(function(resolve,reject){if(!_this4.userFile){return reject(new Error('No user file found. Did you forget to set the \\'dataDir\\' option?'));}var users=_this4._readFile();users[username].password=_this4._hashPassword(password);_this4._writeFile(users);resolve();});},getUsers:function getUsers(){var _this5=this;return new _promise2.default(function(resolve,reject){resolve(_this5._readFile());});},getUserData:function getUserData(username){var _this6=this;return new _promise2.default(function(resolve,reject){var users=_this6._readFile();if(!users[username]){return reject(new Error('User \\''+username+'\\' does not exist'));}resolve(users[username]);});},verifyUser:function verifyUser(username,passwd){var _this7=this;return new _promise2.default(function(resolve,reject){_this7.getUserData(username).then(function(userData){resolve(_this7._verifyPassword(userData.password,passwd));}).catch(reject);});}});exports.default=UserManager;\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"child_process\");\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"events\");\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"keypair\");\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"os\");\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"path\");\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nvar _typeof2=__webpack_require__(9);var _typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}module.exports={isObject:function isObject(value){var type=typeof value==='undefined'?'undefined':(0,_typeof3.default)(value);return!!value&&(type=='object'||type=='function');},invert:function invert(obj){var inverted={};for(var k in obj){if(obj.hasOwnProperty(k)){inverted[obj[k]]=k;}}return inverted;}};\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nvar _assign=__webpack_require__(0);var _assign2=_interopRequireDefault(_assign);var _getIterator2=__webpack_require__(6);var _getIterator3=_interopRequireDefault(_getIterator2);var _keys=__webpack_require__(1);var _keys2=_interopRequireDefault(_keys);var _os=__webpack_require__(19);var _os2=_interopRequireDefault(_os);var _fs=__webpack_require__(4);var _fs2=_interopRequireDefault(_fs);var _path=__webpack_require__(20);var _path2=_interopRequireDefault(_path);var _events=__webpack_require__(17);var _events2=_interopRequireDefault(_events);var _child_process=__webpack_require__(16);var _lodash=__webpack_require__(5);var _lodash2=_interopRequireDefault(_lodash);var _keypair=__webpack_require__(18);var _keypair2=_interopRequireDefault(_keypair);var _cycle=__webpack_require__(10);var _cycle2=_interopRequireDefault(_cycle);var _bunyanStream=__webpack_require__(11);var _bunyanStream2=_interopRequireDefault(_bunyanStream);var _setupServer2=__webpack_require__(12);var _setupServer3=_interopRequireDefault(_setupServer2);var _setupSocket=__webpack_require__(13);var _setupSocket2=_interopRequireDefault(_setupSocket);var _sshManager=__webpack_require__(14);var _sshManager2=_interopRequireDefault(_sshManager);var _commandManager=__webpack_require__(2);var _commandManager2=_interopRequireDefault(_commandManager);var _userManager=__webpack_require__(15);var _userManager2=_interopRequireDefault(_userManager);var _utils=__webpack_require__(3);var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var DEFAULT_PORT=50500;var CONSOLE=_lodash2.default.mapValues(console);var ConsoleEvent=new _events2.default();var HANDLE_TYPES=['log','info','warn','error','dir'];var attachedCount=0;function NodeMonkey(opts){var NODE_ENV=process.NODE_ENV;var options=this.options=_lodash2.default.merge({server:{// You can provide your own server and Node Monkey will use it instead of creating its own.\n// However, this MUST be the underlying http server instance, not the express/restify/whatever app.\nserver:null,host:'0.0.0.0',port:DEFAULT_PORT,silent:false,bufferSize:50,attachOnStart:true,// Only takes effect when Node Monkey is attached to the console\ndisableLocalOutput:false},client:{showCallerInfo:NODE_ENV==='production'?false:true,convertStyles:true},ssh:{enabled:false,host:'0.0.0.0',port:DEFAULT_PORT+1,title:'Node Monkey on '+_os2.default.hostname(),prompt:'[Node Monkey] {@username}@'+_os2.default.hostname()+':'},// Needed for storing things like user files and SSH host keys\ndataDir:null},opts);this.msgBuffer=[];this.BUNYAN_STREAM=(0,_bunyanStream2.default)(this);this._attached=false;this._typeHandlers={};this._createLocal();this._createRemote();this._setupCmdMan();this._setupUserManager();this._setupServer();this._setupSSH();if(options.server.attachOnStart){this.attachConsole();}// TODO: Deprecated. Remove everything after this line by v1.0.0\nvar self=this;var warned=false;function warnConsole(){if(!warned){warned=true;var warningMsg=['[Deprecation Warning] Running Node Monkey with \\'augmentConsole\\' enabled.','This is strongly discouraged and will be removed in the v1.0.0 release.','See here for more info: https://github.com/jwarkentin/node-monkey/releases/tag/v1.0.0-rc.1'].join(' ');self.local.warn(warningMsg);self.remote.warn(warningMsg);}}// This is here because webpack renames the function and for whatever reason the stack trace doesn't show the right name,\n// even with proper source maps. This is all just temporary anyway so I'm hacking it.\nObject.defineProperty(warnConsole,'name',{value:'warnConsole'});console.local=_lodash2.default.mapValues(this.local,function(fn,method){var localFn=function localFn(){warnConsole();return fn.apply(console,arguments);};Object.defineProperty(localFn,'name',{value:method});return localFn;});console.remote=_lodash2.default.mapValues(this.remote,function(fn,method){var remoteFn=function remoteFn(){warnConsole();return fn.apply({callerStackDistance:2},arguments);};Object.defineProperty(remoteFn,'name',{value:method});return remoteFn;});}_lodash2.default.assign(NodeMonkey.prototype,{_getServerProtocol:function _getServerProtocol(server){if(server._events&&server._events.tlsClientError){return'https';}return'http';},getServerPaths:function getServerPaths(){var basePath=_path2.default.normalize(__dirname+'/../dist');return{basePath:basePath,client:'monkey.js',index:'index.html'};},_displayServerWelcome:function _displayServerWelcome(){if(!this.options.server.silent){var server=this.options.server.server;if(server.listening){var proto=this._getServerProtocol(server);var _server$address=server.address(),address=_server$address.address,port=_server$address.port;this.local.log('Node Monkey listening at '+proto+'://'+address+':'+port);}else{server.on('listening',this._displayServerWelcome.bind(this));}}},_setupCmdMan:function _setupCmdMan(){this._cmdMan=new _commandManager2.default();var cmdMan=this.cmdMan=this._cmdMan.bindI({write:function write(val,opts){console.log(val);},writeLn:function writeLn(val,opts){console.log(val);},error:function error(val,opts){console.error(val);},prompt:function prompt(promptTxt,opts,cb){if(typeof opts==='function'){cb=opts;opts=undefined;}opts||(opts={});console.warn('Prompt not implemented');}});this.addCmd=cmdMan.addCmd;this.runCmd=cmdMan.runCmd;},_setupUserManager:function _setupUserManager(){var dataDir=this.options.dataDir;var userMan=this.userManager=new _userManager2.default({userFile:dataDir?dataDir+'/users.json':undefined,silent:this.options.server.silent});this.cmdMan.addCmd('showusers',function(opts,term,done){var users=userMan.getUsers().then(function(users){term.writeLn((0,_keys2.default)(users).join('\\n'));done();});});this.cmdMan.addCmd('adduser',function(opts,term,done){var args=opts.args,username=args._[0];if(!username){term.error('You must specify a username');return done();}term.prompt('Password: ',{hideInput:true},function(error,password){term.writeLn();term.prompt('Again: ',{hideInput:true},function(error,passwordAgain){term.writeLn();if(password===passwordAgain){userMan.createUser(username,password).then(function(){return term.write('Created user \\''+username+'\\'');}).catch(term.error).then(done);}else{term.error('Passwords do not match');done();}});});});this.cmdMan.addCmd('deluser',function(opts,term,done){var args=opts.args,username=args._[0];if(!username){term.error('You must specify a username');return done();}userMan.deleteUser(username).then(function(){return term.write('Deleted user \\''+username+'\\'');}).catch(term.error).then(done);});this.cmdMan.addCmd('passwd',function(opts,term,done){var args=opts.args,user=opts.username;term.prompt('Current password: ',{hideInput:true},function(error,curpwd){term.writeLn();userMan.verifyUser(user,curpwd).then(function(matches){if(matches){term.prompt('Password: ',{hideInput:true},function(error,password){term.writeLn();term.prompt('Again: ',{hideInput:true},function(error,passwordAgain){term.writeLn();if(password===passwordAgain){userMan.setPassword(user,password).then(function(){return term.write('Updated password for '+user);}).catch(term.error).then(done);}else{term.error('Passwords do not match');done();}});});}else{term.error('Incorrect password');done();}});});});},_setupServer:function _setupServer(){var options=this.options,server=options.server.server;if(!server){var serverApp=(0,_setupServer3.default)({name:'Node Monkey'});server=this.options.server.server=serverApp.server;var _options$server=options.server,host=_options$server.host,port=_options$server.port;serverApp.listen(port,host);}this._displayServerWelcome();this.serverApp=server;this.remoteClients=(0,_setupSocket2.default)({server:server.server||server,userManager:this.userManager,onAuth:this._sendMessages.bind(this),clientSettings:options.client});},_setupSSH:function _setupSSH(){var sshOpts=this.options.ssh;if(sshOpts.enabled){var dataDir=this.options.dataDir;if(!dataDir){throw new Error('Options \\'dataDir\\' is required to enable SSH');}// Get host keys\nvar files=_fs2.default.readdirSync(dataDir),keyRe=/\\.key$/,hostKeys=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=(0,_getIterator3.default)(files),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var file=_step.value;if(keyRe.test(file)){hostKeys.push(dataDir+'/'+file);}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}if(!hostKeys.length){console.log('No SSH host key found. Generating new host key...');var keys=(0,_keypair2.default)();_fs2.default.writeFileSync(dataDir+'/rsa.key',keys.private);_fs2.default.writeFileSync(dataDir+'/rsa.key.pub',keys.public);hostKeys=[dataDir+'/rsa.key'];}this.SSHMan=new _sshManager2.default({monkey:this,cmdManager:this._cmdMan,userManager:this.userManager,silent:this.options.server.silent,host:sshOpts.host,port:sshOpts.port,title:_lodash2.default.result(sshOpts,'title'),prompt:_lodash2.default.result(sshOpts,'prompt'),hostKeys:hostKeys});}},// TODO: This whole process of trying to identify the true source of the call is so fucking messy and fragile. Need to think\n//       of a better way to identify the call source and rewrite all this shitty code handling it right now.\n_getCallerInfo:function _getCallerInfo(callerStackDistance){if(this.options.client.showCallerInfo){var stack=_utils2.default.getStack().map(function(frame){return{functionName:frame.getFunctionName(),methodName:frame.getMethodName(),fileName:frame.getFileName(),lineNumber:frame.getLineNumber(),columnNumber:frame.getColumnNumber()};});var caller=stack.find(function(frame,index,stack){// We're either looking for a console method call or a bunyan log call. This logic will break down if method names change.\nvar twoBack=stack[index-2];var sixBack=stack[index-4];if(twoBack&&twoBack.functionName==='Logger._emit'&&/\\/bunyan\\.js$/.test(twoBack.fileName)){return true;}else if(twoBack&&sixBack&&twoBack.methodName==='emit'&&sixBack.methodName==='_sendMessage'){return true;}});if(!caller&&typeof callerStackDistance==='number'){caller=stack[callerStackDistance];}if(caller){return{caller:caller.functionName||caller.methodName,file:caller.fileName,line:caller.lineNumber,column:caller.columnNumber};}}},_sendMessage:function _sendMessage(info,callerStackDistance){this.msgBuffer.push({method:info.method,args:info.args,callerInfo:info.callerInfo||this._getCallerInfo(callerStackDistance+1)});if(this.msgBuffer.length>this.options.server.bufferSize){this.msgBuffer.shift();}this._sendMessages();},_sendMessages:function _sendMessages(){var remoteClients=this.remoteClients;if(_lodash2.default.size(remoteClients.adapter.rooms['authed'])){_lodash2.default.each(this.msgBuffer,function(info){remoteClients.to('authed').emit('console',_cycle2.default.decycle(info));});this.msgBuffer=[];}},_createLocal:function _createLocal(){// NOTE: The console functions here should not be wrapped since these values are used to restore the defaults\n//       when `detachConsole()` is called.\nthis.local=CONSOLE;},_createRemote:function _createRemote(){var self=this;var remote=this.remote={};HANDLE_TYPES.forEach(function(method){self.remote[method]=function(){self._sendMessage({method:method,args:Array.prototype.slice.call(arguments)},this.callerStackDistance?this.callerStackDistance+1:2);};Object.defineProperty(remote[method],'name',{value:method});});},attachConsole:function attachConsole(disableLocalOutput){var _this=this;if(this._attached){return;}if(!attachedCount){// If this function is in the process of handling the log call we will try and prevent potential infinite recursion\nvar handlersActive=0;HANDLE_TYPES.forEach(function(method){console[method]=function(){if(handlersActive){return self.local[method].apply(console,arguments);}++handlersActive;ConsoleEvent.emit.apply(ConsoleEvent,[method].concat(Array.prototype.slice.call(arguments)));--handlersActive;};Object.defineProperty(console[method],'name',{value:method});});}++attachedCount;var self=this;var serverOptions=this.options.server;disableLocalOutput=disableLocalOutput!==undefined?disableLocalOutput:serverOptions.disableLocalOutput;_lodash2.default.each(this.remote,function(fn,method){var handler=_this._typeHandlers[method]=function(){fn.apply({callerStackDistance:5},arguments);if(!disableLocalOutput){self.local[method].apply(console,arguments);}};Object.defineProperty(handler,'name',{value:method});ConsoleEvent.on(method,handler);});this._attached=true;},detachConsole:function detachConsole(){var _this2=this;(0,_assign2.default)(console,this.local);this._attached=false;--attachedCount;HANDLE_TYPES.forEach(function(method){ConsoleEvent.removeListener(method,_this2._typeHandlers[method]);delete _this2._typeHandlers[method];});}});var instances={};var lastPort=DEFAULT_PORT-1;module.exports=function createInst(options){var name=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'default';if(typeof options==='string'){name=options;options=undefined;}if(!instances[name]){options||(options={});var port=_lodash2.default.get(options,'server.port');if(port){lastPort=+port;}else{_lodash2.default.set(options,'server.port',++lastPort);_lodash2.default.set(options,'ssh.port',++lastPort);}instances[name]=new NodeMonkey(options);}return instances[name];};// Just exporting in case someone needs to wrap this or access the internals for some reason\nmodule.exports.NodeMonkey=NodeMonkey;\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"minimist\");\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"pty.js\");\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"restify\");\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"scrypt\");\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"socket.io\");\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"source-map-support\");\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"ssh2\");\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"terminal-kit\");\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"tty\");\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// server.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 22);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a3db8a4a6a641e5224f1","module.exports = require(\"babel-runtime/core-js/object/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/assign\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/object/keys\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/keys\"\n// module id = 1\n// module chunks = 0","import _ from 'lodash'\nimport utils from './utils'\nimport minimist from 'minimist'\n\nfunction CommandManager() {\n  this.commands = {}\n}\n\nObject.assign(CommandManager.prototype, {\n  addCmd(cmdName, opts, exec) {\n    if (this.commands[cmdName]) {\n      throw new Error(`'${cmdName}' is already registered as a command`)\n    }\n\n    if (typeof opts === 'function') {\n      exec = opts\n      opts = {}\n    }\n\n    this.commands[cmdName] = {\n      opts,\n      exec\n    }\n  },\n\n  bindI(ioInterface) {\n    let boundI = _.mapValues(this)\n    Object.assign(boundI, _.mapValues(this.constructor.prototype, (val, key) => {\n      if (val instanceof Function) {\n        if (key === 'runCmd') {\n          return val.bind(this, ioInterface)\n        }\n        return val.bind(this)\n      } else {\n        return val\n      }\n    }))\n\n    return boundI\n  },\n\n  runCmd(io, rawCommand, asUser) {\n    return new Promise((resolve, reject) => {\n      let parsed = utils.parseCommand(rawCommand),\n          cmdName = parsed[0],\n          cmd = this.commands[cmdName]\n\n      if (!asUser) {\n        return reject(`Missing user context for command '${cmdName}'`)\n      }\n\n      if (!cmd) {\n        return reject(`Command not found: '${cmdName}'`)\n      }\n\n      let args = minimist(parsed.slice(1))\n      cmd.exec({\n          args,\n          username: asUser\n        }, {\n          write: io.write,\n          writeLn: io.writeLn,\n          error: io.error,\n          prompt: io.prompt\n        },\n        resolve\n      )\n    })\n  }\n})\n\n\nexport default CommandManager\n\n\n// WEBPACK FOOTER //\n// ./server/command-manager.js","import commonUtils from '../lib/common-utils'\nimport sourceMapSupport from 'source-map-support'\n\nexport default Object.assign({\n  parseCommand(str) {\n    const reg = /\"(.*?)\"|'(.*?)'|`(.*?)`|([^\\s\"]+)/gi\n    let arr = [],\n        match\n\n    do {\n      match = reg.exec(str)\n      if (match !== null) {\n        arr.push(match[1] || match[2] || match[3] || match[4])\n      }\n    } while (match !== null)\n\n    return arr\n  },\n\n  getStack() {\n    let prep = Error.prepareStackTrace\n    let limit = Error.stackTraceLimit\n    Error.prepareStackTrace = (error, trace) => trace.map(sourceMapSupport.wrapCallSite)\n    Error.stackTraceLimit = 30\n\n    let stack = new Error().stack\n    Error.prepareStackTrace = prep\n    Error.stackTraceLimit = limit\n\n    return stack.slice(1)\n  }\n}, commonUtils)\n\n\n// WEBPACK FOOTER //\n// ./server/utils.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/get-iterator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/get-iterator\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/json/stringify\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/promise\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/typeof\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/typeof\"\n// module id = 9\n// module chunks = 0","/*\n    cycle.js\n    2016-05-01\n\n    Public Domain.\n\n    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n    This code should be minified before deployment.\n    See http://javascript.crockford.com/jsmin.html\n\n    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n    NOT CONTROL.\n*/\n\n/*jslint eval, for */\n\n/*property\n    $ref, decycle, forEach, isArray, keys, length, push, retrocycle, stringify,\n    test\n*/\n\nlet origJSON = global.JSON,\n    JSON = {}\nmodule.exports = JSON\n\nif (typeof JSON.decycle !== \"function\") {\n    JSON.decycle = function decycle(object, replacer) {\n        \"use strict\";\n\n// Make a deep copy of an object or array, assuring that there is at most\n// one instance of each object or array in the resulting structure. The\n// duplicate references (which might be forming cycles) are replaced with\n// an object of the form\n\n//      {\"$ref\": PATH}\n\n// where the PATH is a JSONPath string that locates the first occurance.\n\n// So,\n\n//      var a = [];\n//      a[0] = a;\n//      return JSON.stringify(JSON.decycle(a));\n\n// produces the string '[{\"$ref\":\"$\"}]'.\n\n// If a replacer function is provided, then it will be called for each value.\n// A replacer function receives a value and returns a replacement value.\n\n// JSONPath is used to locate the unique object. $ indicates the top level of\n// the object or array. [NUMBER] or [STRING] indicates a child element or\n// property.\n\n        var objects = [];   // Keep a reference to each unique object or array\n        var paths = [];     // Keep the path to each unique object or array\n\n        return (function derez(value, path) {\n\n// The derez function recurses through the object, producing the deep copy.\n\n            var i;          // The loop counter\n            var nu;         // The new object or array\n\n// If a replacer function was provided, then call it to get a replacement value.\n\n            if (replacer !== undefined) {\n                value = replacer(value);\n            }\n\n// typeof null === \"object\", so go on if this value is really an object but not\n// one of the weird builtin objects.\n\n            if (\n                typeof value === \"object\" && value !== null &&\n                !(value instanceof Boolean) &&\n                !(value instanceof Date) &&\n                !(value instanceof Number) &&\n                !(value instanceof RegExp) &&\n                !(value instanceof String)\n            ) {\n\n// If the value is an object or array, look to see if we have already\n// encountered it. If so, return a {\"$ref\":PATH} object. This is a hard\n// linear search that will get slower as the number of unique objects grows.\n// Someday, this should be replaced with an ES6 WeakMap.\n\n                i = objects.indexOf(value);\n                if (i >= 0) {\n                    return {$ref: paths[i]};\n                }\n\n// Otherwise, accumulate the unique value and its path.\n\n                objects.push(value);\n                paths.push(path);\n\n// If it is an array, replicate the array.\n\n                if (Array.isArray(value)) {\n                    nu = [];\n                    value.forEach(function (element, i) {\n                        nu[i] = derez(element, path + \"[\" + i + \"]\");\n                    });\n                } else {\n\n// If it is an object, replicate the object.\n\n                    nu = {};\n                    Object.keys(value).forEach(function (name) {\n                        nu[name] = derez(\n                            value[name],\n                            path + \"[\" + JSON.stringify(name) + \"]\"\n                        );\n                    });\n                }\n                return nu;\n            }\n            return value;\n        }(object, \"$\"));\n    };\n}\n\n\nif (typeof JSON.retrocycle !== \"function\") {\n    JSON.retrocycle = function retrocycle($) {\n        \"use strict\";\n\n// Restore an object that was reduced by decycle. Members whose values are\n// objects of the form\n//      {$ref: PATH}\n// are replaced with references to the value found by the PATH. This will\n// restore cycles. The object will be mutated.\n\n// The eval function is used to locate the values described by a PATH. The\n// root object is kept in a $ variable. A regular expression is used to\n// assure that the PATH is extremely well formed. The regexp contains nested\n// * quantifiers. That has been known to have extremely bad performance\n// problems on some browsers for very long strings. A PATH is expected to be\n// reasonably short. A PATH is allowed to belong to a very restricted subset of\n// Goessner's JSONPath.\n\n// So,\n//      var s = '[{\"$ref\":\"$\"}]';\n//      return JSON.retrocycle(JSON.parse(s));\n// produces an array containing a single element which is the array itself.\n\n        var px = /^\\$(?:\\[(?:\\d+|\\\"(?:[^\\\\\\\"\\u0000-\\u001f]|\\\\([\\\\\\\"\\/bfnrt]|u[0-9a-zA-Z]{4}))*\\\")\\])*$/;\n\n        (function rez(value) {\n\n// The rez function walks recursively through the object looking for $ref\n// properties. When it finds one that has a value that is a path, then it\n// replaces the $ref object with a reference to the value that is found by\n// the path.\n\n            if (value && typeof value === \"object\") {\n                if (Array.isArray(value)) {\n                    value.forEach(function (element, i) {\n                        if (typeof element === \"object\" && element !== null) {\n                            var path = element.$ref;\n                            if (typeof path === \"string\" && px.test(path)) {\n                                value[i] = eval(path);\n                            } else {\n                                rez(element);\n                            }\n                        }\n                    });\n                } else {\n                    Object.keys(value).forEach(function (name) {\n                        var item = value[name];\n                        if (typeof item === \"object\" && item !== null) {\n                            var path = item.$ref;\n                            if (typeof path === \"string\" && px.test(path)) {\n                                value[name] = eval(path);\n                            } else {\n                                rez(item);\n                            }\n                        }\n                    });\n                }\n            }\n        }($));\n        return $;\n    };\n}\n\nJSON = origJSON\n\n\n// WEBPACK FOOTER //\n// ./lib/cycle.js","import utils from './utils'\n\nconst BUNYAN_TRACE = 10\nconst BUNYAN_DEBUG = 20\nconst BUNYAN_INFO = 30\nconst BUNYAN_WARN = 40\nconst BUNYAN_ERROR = 50\nconst BUNYAN_FATAL = 60\n\nlet levelFromName = {\n  'trace': BUNYAN_TRACE,\n  'debug': BUNYAN_DEBUG,\n  'info': BUNYAN_INFO,\n  'warn': BUNYAN_WARN,\n  'error': BUNYAN_ERROR,\n  'fatal': BUNYAN_FATAL\n}\nlet nameFromLevel = utils.invert(levelFromName)\n\nexport default inst => {\n  return {\n    write: function(rec) {\n      rec = JSON.parse(rec)\n      inst._sendMessage({\n        method: nameFromLevel[rec.level] || 'info',\n        args: [ rec.msg, rec ]\n      })\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./server/bunyan-stream.js","import restify from 'restify'\n\nexport default options => {\n  let server = restify.createServer()\n\n  server.pre(restify.pre.userAgentConnection())\n  server.use(restify.gzipResponse())\n  server.use(restify.CORS({\n    credentials: true\n  }))\n\n  server.get(/.*/, restify.serveStatic({\n    directory: __dirname,\n    default: 'index.html'\n  }))\n\n  return server\n}\n\n\n// WEBPACK FOOTER //\n// ./server/setup-server.js","import _ from 'lodash'\nimport socketio from 'socket.io'\nimport CmdMan from './command-manager'\n\nexport default options => {\n  let io, ns\n  let userManager = options.userManager\n\n  if (typeof options.server === 'function') {\n    io = socketio(options.server)\n  } else {\n    io = socketio()\n    io.attach(options.server)\n  }\n\n  ns = io.of('/nm')\n  ns.on('connection', socket => {\n    let cmdMan = null\n    socket.emit('settings', options.clientSettings)\n    socket.emit('auth')\n\n    socket.on('auth', creds => {\n      userManager.verifyUser(creds.username, creds.password).then(result => {\n        socket.emit('authResponse', result, result ? undefined : 'Incorrect password')\n        if (result) {\n          socket.username = creds.username\n          socket.join('authed')\n          if (options.onAuth) {\n            options.onAuth(socket)\n          }\n        }\n      }).catch(err => {\n        socket.emit('authResponse', false, err)\n      })\n    })\n\n    socket.on('cmd', (cmdId, command) => {\n      if (!socket.username) {\n        socket.emit('cmdResponse', cmdId, `You are not authorized to run commands`)\n        return\n      }\n\n      if (!cmdMan) {\n        cmdMan = createCmdMan(socket)\n      }\n\n      cmdMan.runCmd(command, socket.username)\n        .then(output => {\n          socket.emit('cmdResponse', cmdId, null, output)\n        }).catch(err => {\n          socket.emit('cmdResponse', cmdId, err && err.message || err, null)\n        })\n    })\n  })\n\n  _.each(options.handlers, function(handler, event) {\n    io.on(event, handler)\n  })\n\n  return ns\n}\n\nfunction createCmdMan(socket) {\n  let promptId = 0,\n      prompts = {}\n\n  let cmdManOpts = {\n    writeLn: null,\n    write: (val, opts) => {\n      if (!val) return\n\n      socket.emit('console', {\n        method: 'log',\n        args: [ val ]\n      })\n    },\n    error: (val, opts) => {\n      if (!val) return\n\n      socket.emit('console', {\n        method: 'error',\n        args: [ val ]\n      })\n    },\n    prompt: (promptTxt, opts, cb) => {\n      if (typeof opts === 'function') {\n        cb = opts\n        opts = undefined\n      }\n      opts || (opts = {})\n\n      let pid = promptId++\n      socket.emit('prompt', pid, promptTxt, opts)\n\n      prompts[pid] = cb\n    }\n  }\n  cmdManOpts.writeLn = cmdManOpts.write\n\n  socket.on('promptResponse', (promptId, response) => {\n    if (prompts[promptId]) {\n      prompts[promptId](null, response)\n    }\n  })\n\n  return new CmdMan(cmdManOpts)\n}\n\n\n// WEBPACK FOOTER //\n// ./server/setup-socket.js","import fs from 'fs'\nimport tty from 'tty'\nimport pty from 'pty.js'\nimport ssh2 from 'ssh2'\nimport termkit from 'terminal-kit'\nimport CmdMan from './command-manager'\n\nfunction SSHManager(options) {\n  this.options = options = Object.assign({\n    host: '127.0.0.1',\n    port: 50501,\n    title: 'Node Monkey',\n    prompt: 'Node Monkey:',\n    silent: false\n  }, options)\n\n  this.clients = {}\n  this.clientId = 1\n\n  this.server = ssh2.Server({\n    hostKeys: options.hostKeys.map(file => {\n      return fs.readFileSync(file)\n    })\n  }, this.onClient.bind(this))\n\n  let monkey = this.options.monkey\n  this.server.listen(options.port, options.host, function() {\n    options.silent || monkey.local.log(`SSH listening on ${this.address().port}`)\n  })\n}\n\nObject.assign(SSHManager.prototype, {\n  shutdown() {\n    let clients = this.clients\n    for (let c of clients) {\n      c.write('\\nShutting down')\n      c.close()\n    }\n  },\n\n  onClient(client) {\n    let clientId = clientId++\n    this.clients[clientId] = new SSHClient({\n      client,\n      cmdManager: this.options.cmdManager,\n      userManager: this.options.userManager,\n      title: this.options.title,\n      prompt: this.options.prompt,\n      onClose: () => delete this.clients[clientId]\n    })\n  }\n})\n\n\nfunction SSHClient(options) {\n  this.options = options\n  this.client = options.client\n  this.cmdMan = null\n  this.userManager = options.userManager\n  this.session = null\n  this.stream = null\n  this.pty = null\n  this.term = null\n  this.ptyInfo = null\n\n  this.title = options.title\n  this.promptTxt = `${options.prompt} `\n  this.inputActive = false\n  this.cmdHistory = []\n\n  this.username = null\n\n  this.client.on('authentication', this.onAuth.bind(this))\n  this.client.on('ready', this.onReady.bind(this))\n  this.client.on('end', this.onClose.bind(this))\n}\n\nObject.assign(SSHClient.prototype, {\n  _initCmdMan() {\n    let cmdManOpts = {\n      writeLn: null,\n      write: (val, opts) => {\n        opts || (opts = {})\n        val || (val = '')\n\n        if (opts.bold) {\n          this.term.bold(val)\n        } else {\n          this.term(val)\n        }\n\n        if (opts.newline) {\n          this.term.nextLine()\n        }\n      },\n      error: (val, opts) => {\n        opts || (opts = {})\n\n        // TODO: Apparently by sending this to stdout there is a timing issue and anything sent to\n        //       stdout appears before this value is sent to stderr for some reason.\n        // this.term.red.error(val)\n        this.term.red(val)\n\n        if (opts.newline) {\n          this.term.nextLine()\n        }\n      },\n      prompt: (promptTxt = '', opts, cb) => {\n        if (typeof opts === 'function') {\n          cb = opts\n          opts = undefined\n        }\n        opts || (opts = {})\n\n        let inputOpts = {}\n        if (opts.hideInput) {\n          inputOpts.echo = false\n        }\n\n        this.term(promptTxt)\n        this.term.inputField(inputOpts, cb)\n      }\n    }\n    cmdManOpts.writeLn = (val, opts) => {\n      opts || (opts = {})\n      opts.newline = true\n      cmdManOpts.write(val, opts)\n    }\n    this.cmdMan = this.options.cmdManager.bindI(cmdManOpts)\n  },\n\n  write(msg, opts) {\n    opts || (opts = {})\n    if (this.term) {\n      if (opts.style) {\n        this.term[style](msg)\n      } else {\n        this.term(msg)\n      }\n    }\n  },\n\n  close() {\n    if (this.stream) {\n      this.stream.end()\n    }\n    this.onClose()\n  },\n\n  onAuth(ctx) {\n    if (ctx.method == 'password') {\n      this.userManager.verifyUser(ctx.username, ctx.password).then(result => {\n        if (result) {\n          this.username = ctx.username\n          ctx.accept()\n        } else {\n          ctx.reject()\n        }\n      }).catch(err => {\n        ctx.reject()\n      })\n    } else if (ctx.method == 'publickey') {\n      ctx.reject()\n    } else {\n      ctx.reject()\n    }\n  },\n\n  onReady() {\n    this.client.on('session', (accept, reject) => {\n      this.session = accept()\n\n      this.session\n        .once('pty', (accept, reject, info) => {\n          this.ptyInfo = info\n          accept && accept()\n        })\n        .on('window-change', (accept, reject, info) => {\n          Object.assign(this.ptyInfo, info)\n          this._resize()\n          accept && accept()\n        })\n        .once('shell', (accept, reject) => {\n          this.stream = accept()\n          this._initCmdMan()\n          this._initStream()\n          this._initPty()\n          this._initTerm()\n        })\n    })\n  },\n\n  onClose() {\n    let onClose = this.options.onClose\n    onClose && onClose()\n  },\n\n  onKey(name, matches, data) {\n    if (name === 'CTRL_L') {\n      this.clearScreen()\n    } else if (name === 'CTRL_C') {\n      this.inputActive = false\n      this.inputField.abort()\n      this.term('\\n^^C\\n')\n      this.prompt()\n    } else if (name === 'CTRL_D') {\n      let input = this.inputField.getInput()\n      if (!input.length) {\n        this.term.nextLine()\n        setTimeout(() => {\n          this.close()\n        }, 0)\n      }\n    }\n  },\n\n  _resize() {\n    let term = this.term\n    if (this.term) {\n      this.term.stdout.emit('resize')\n    }\n  },\n\n  _initStream() {\n    let stream = this.stream\n    stream.name = this.title\n    stream.isTTY = true\n    stream.setRawMode = () => {}\n    stream.on('error', error => {\n      console.error('SSH stream error:', error.message)\n    })\n  },\n\n  _initPty() {\n    let newPty = pty.native.open(this.ptyInfo.cols, this.ptyInfo.rows)\n    this.pty = {\n      master_fd: newPty.master,\n      slave_fd: newPty.slave,\n      master: new tty.WriteStream(newPty.master),\n      slave: new tty.ReadStream(newPty.slave)\n    }\n    this.pty.slave.getWindowSize = () => {\n      return [ this.ptyInfo.cols, this.ptyInfo.rows ]\n    }\n    this.stream.stdin.pipe(this.pty.master)\n    this.pty.master.pipe(this.stream.stdout)\n  },\n\n  _initTerm() {\n    let stream = this.stream\n\n    let term = this.term = termkit.createTerminal({\n      stdin: this.pty.slave,\n      stdout: this.pty.slave,\n      stderr: this.pty.slave,\n      generic: this.ptyInfo.term,\n      appName: this.title\n    })\n\n    term.on('key', this.onKey.bind(this))\n    term.windowTitle(this._interpolate(this.title))\n    this.clearScreen()\n  },\n\n  _interpolate(str) {\n    let varRe = /{@(.+?)}/g\n    let vars = {\n      username: this.username\n    }\n\n    let match\n    while(match = varRe.exec(str)) {\n      if (vars[match[1]]) {\n        str = str.replace(match[0], vars[match[1]])\n      }\n    }\n\n    return str\n  },\n\n  clearScreen() {\n    this.term.clear()\n    this.prompt()\n  },\n\n  prompt() {\n    let term = this.term\n    term.windowTitle(this._interpolate(this.title))\n    term.bold(this._interpolate(this.promptTxt))\n\n    if (!this.inputActive) {\n      this.inputActive = true\n      this.inputField = term.inputField({\n        history: this.cmdHistory,\n        autoComplete: Object.keys(this.cmdMan.commands),\n        autoCompleteMenu: true\n      }, (error, input) => {\n        this.inputActive = false\n        term.nextLine()\n\n        if (error) {\n          return term.error(error.message || error)\n        }\n\n        if (!input) {\n          return this.prompt()\n        }\n        input[0] !== ' ' && this.cmdHistory.push(input)\n\n        if (input === 'exit') {\n          // This is delayed briefly so the newline can be echoed to the client, creating cleaner output when exiting\n          setTimeout(this.close.bind(this))\n        } else if (input === 'clear') {\n          this.clearScreen()\n        } else if (input) {\n          this.cmdMan.runCmd(input, this.username)\n            .then(output => {\n              if (typeof output !== 'string') {\n                output = JSON.stringify(output, null, '  ')\n              }\n              this.term(output)\n              this.term.nextLine()\n              this.prompt()\n            })\n            .catch(err => {\n              if (typeof err !== 'string') {\n                err = err.message || JSON.stringify(err, null, '  ')\n              }\n              this.term.red.error(err)\n              this.term.nextLine()\n              this.prompt()\n            })\n        } else {\n          this.prompt()\n        }\n      })\n    }\n  }\n})\n\n\nexport default SSHManager\n\n\n// WEBPACK FOOTER //\n// ./server/ssh-manager.js","import fs from 'fs'\nimport scrypt from 'scrypt'\n\nlet useNew = false\ntry {\n  Buffer.from('', 'base64')\n} catch(err) {\n  useNew = true\n}\n\nfunction stringToBuffer(string, base) {\n  if (useNew) {\n    return new Buffer(string, base)\n  } else {\n    return Buffer.from(string, base)\n  }\n}\n\nfunction UserManager(options) {\n  this.userFile = options.userFile\n  this.userFileCache = null\n  this.userFileCreated = false\n\n  if (!options.silent) {\n    this.getUsers().then(users => {\n      let usernames = Object.keys(users)\n      if (!usernames.length) {\n        if (process.env.NODE_ENV === 'production') {\n          console.warn(`No users have been created and you are running in production mode so you will not be able to login.\\n`)\n        } else {\n          console.warn(`It seems there are no users and you are not running in production mode so you will not be able to login. This is probably a bug. Please report it!\\n`)\n        }\n      } else if (usernames.length === 1 && usernames[0] === 'guest') {\n        console.warn(`[WARN] No users detected. You can login with default user 'guest' and password 'guest' when prompted.\\n` +\n          `This user will be disabled when you create a user account.\\n`)\n      }\n    })\n  }\n}\n\nObject.assign(UserManager.prototype, {\n  _readFile() {\n    if (this.userFileCache) {\n      return this.userFileCache\n    }\n\n    try {\n      if (!this.userFile) {\n        let err = new Error(`No user file specified`)\n        err.code = 'ENOENT'\n        throw err\n      }\n\n      this.userFileCache = JSON.parse(fs.readFileSync(this.userFile))\n      this.userFileCreated = true\n      setTimeout(() => { this.userFileCache = null }, 5000)\n\n      return this.userFileCache\n    } catch(err) {\n      if (err.code === 'ENOENT') {\n        return process.env.NODE_ENV === 'production'\n          ? {}\n          : {\n            guest: {\n              password: 'c2NyeXB0AAEAAAABAAAAAZS+vE1+zh4nY6vN21zM3dIzpJVImr8OrK0iJoA+iUPk7WIdo3RhgeATzWENocd7gKNbEKVgq6LbXqrmVjLtnYy5FXyfRCtEtmjUuj19AqcW'\n            }\n          }\n      }\n      throw err\n    }\n  },\n\n  _writeFile(data) {\n    this.userFileCache = null\n    fs.writeFileSync(this.userFile, JSON.stringify(data, null, '  '))\n    this.userFileCreated = true\n  },\n\n  _hashPassword(passwd) {\n    return scrypt.kdfSync(passwd.normalize('NFKC'), { N: 1, r: 1, p: 1 }).toString('base64')\n  },\n\n  _verifyPassword(hash, passwd) {\n    return scrypt.verifyKdfSync(stringToBuffer(hash, 'base64'), passwd.normalize('NFKC'))\n  },\n\n  createUser(username, password) {\n    return new Promise((resolve, reject) => {\n      if (!this.userFile) {\n        return reject(new Error(`No user file found. Did you forget to set the 'dataDir' option?`))\n      }\n\n      let users = this._readFile()\n      if (users[username]) {\n        return reject(new Error(`User '${username}' already exists`))\n      }\n\n      if (!this.userFileCreated) {\n        delete users['guest']\n      }\n\n      users[username] = {\n        password: this._hashPassword(password)\n      }\n      this._writeFile(users)\n      resolve()\n    })\n  },\n\n  deleteUser(username) {\n    return new Promise((resolve, reject) => {\n      if (!this.userFile) {\n        return reject(new Error(`No user file found. Did you forget to set the 'dataDir' option?`))\n      }\n\n      let users = this._readFile()\n      if (!users[username]) {\n        return reject(new Error(`User '${username}' does not exist`))\n      }\n\n      if (!this.userFileCreated) {\n        return reject(new Error(`User file has not been created`))\n      }\n\n      delete users[username]\n      this._writeFile(users)\n      resolve()\n    })\n  },\n\n  setPassword(username, password) {\n    return new Promise((resolve, reject) => {\n      if (!this.userFile) {\n        return reject(new Error(`No user file found. Did you forget to set the 'dataDir' option?`))\n      }\n\n      let users = this._readFile()\n\n      users[username].password = this._hashPassword(password)\n      this._writeFile(users)\n      resolve()\n    })\n  },\n\n  getUsers() {\n    return new Promise((resolve, reject) => {\n      resolve(this._readFile())\n    })\n  },\n\n  getUserData(username) {\n    return new Promise((resolve, reject) => {\n      let users = this._readFile()\n      if (!users[username]) {\n        return reject(new Error(`User '${username}' does not exist`))\n      }\n\n      resolve(users[username])\n    })\n  },\n\n  verifyUser(username, passwd) {\n    return new Promise((resolve, reject) => {\n      this.getUserData(username).then(userData => {\n        resolve(this._verifyPassword(userData.password, passwd))\n      }).catch(reject)\n    })\n  }\n})\n\n\nexport default UserManager\n\n\n\n// WEBPACK FOOTER //\n// ./server/user-manager.js","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"events\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"events\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"keypair\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"keypair\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"os\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"os\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 20\n// module chunks = 0","module.exports = {\n  isObject(value) {\n    let type = typeof value\n    return !!value && (type == 'object' || type == 'function')\n  },\n\n  invert(obj) {\n    let inverted = {}\n    for (let k in obj) {\n      if (obj.hasOwnProperty(k)) {\n        inverted[obj[k]] = k\n      }\n    }\n\n    return inverted\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/common-utils.js","import os from 'os'\nimport fs from 'fs'\nimport path from 'path'\nimport EventEmitter from 'events'\nimport { execSync } from 'child_process'\nimport _ from 'lodash'\nimport keypair from 'keypair'\nimport cycle from '../lib/cycle'\nimport bunyanStream from './bunyan-stream'\nimport setupServer from './setup-server'\nimport setupSocket from './setup-socket'\nimport SSHMan from './ssh-manager'\nimport CmdMan from './command-manager'\nimport UserManager from './user-manager'\nimport utils from './utils'\n\nconst DEFAULT_PORT = 50500\nconst CONSOLE = _.mapValues(console)\nconst ConsoleEvent = new EventEmitter()\nconst HANDLE_TYPES = [ 'log', 'info', 'warn', 'error', 'dir' ]\n\nlet attachedCount = 0\n\nfunction NodeMonkey(opts) {\n  const NODE_ENV = process.NODE_ENV\n  let options = this.options = _.merge({\n    server: {\n      // You can provide your own server and Node Monkey will use it instead of creating its own.\n      // However, this MUST be the underlying http server instance, not the express/restify/whatever app.\n      server: null,\n\n      host: '0.0.0.0',\n      port: DEFAULT_PORT,\n      silent: false,\n      bufferSize: 50,\n      attachOnStart: true,\n\n      // Only takes effect when Node Monkey is attached to the console\n      disableLocalOutput: false\n    },\n    client: {\n      showCallerInfo: NODE_ENV === 'production' ? false : true,\n      convertStyles: true\n    },\n    ssh: {\n      enabled: false,\n      host: '0.0.0.0',\n      port: DEFAULT_PORT + 1,\n      title: `Node Monkey on ${os.hostname()}`,\n      prompt: `[Node Monkey] {@username}@${os.hostname()}:`\n    },\n\n    // Needed for storing things like user files and SSH host keys\n    dataDir: null\n  }, opts)\n\n  this.msgBuffer = []\n  this.BUNYAN_STREAM = bunyanStream(this)\n  this._attached = false\n  this._typeHandlers = {}\n\n  this._createLocal()\n  this._createRemote()\n  this._setupCmdMan()\n  this._setupUserManager()\n  this._setupServer()\n  this._setupSSH()\n\n  if (options.server.attachOnStart) {\n    this.attachConsole()\n  }\n\n  // TODO: Deprecated. Remove everything after this line by v1.0.0\n  let self = this\n  let warned = false\n  function warnConsole() {\n    if (!warned) {\n      warned = true\n      let warningMsg = [\n        `[Deprecation Warning] Running Node Monkey with 'augmentConsole' enabled.`,\n        `This is strongly discouraged and will be removed in the v1.0.0 release.`,\n        `See here for more info: https://github.com/jwarkentin/node-monkey/releases/tag/v1.0.0-rc.1`\n      ].join(' ')\n      self.local.warn(warningMsg)\n      self.remote.warn(warningMsg)\n    }\n  }\n\n  // This is here because webpack renames the function and for whatever reason the stack trace doesn't show the right name,\n  // even with proper source maps. This is all just temporary anyway so I'm hacking it.\n  Object.defineProperty(warnConsole, 'name', { value: 'warnConsole' })\n\n  console.local = _.mapValues(this.local, (fn, method) => {\n    let localFn = function() {\n      warnConsole()\n      return fn.apply(console, arguments)\n    }\n    Object.defineProperty(localFn, 'name', { value: method })\n    return localFn\n  })\n  console.remote = _.mapValues(this.remote, (fn, method) => {\n    let remoteFn = function() {\n      warnConsole()\n      return fn.apply({ callerStackDistance: 2 }, arguments)\n    }\n    Object.defineProperty(remoteFn, 'name', { value: method })\n    return remoteFn\n  })\n}\n\n_.assign(NodeMonkey.prototype, {\n  _getServerProtocol(server) {\n    if (server._events && server._events.tlsClientError) {\n      return 'https'\n    }\n    return 'http'\n  },\n\n  getServerPaths() {\n    let basePath = path.normalize(`${__dirname}/../dist`)\n\n    return {\n      basePath,\n      client: 'monkey.js',\n      index: 'index.html'\n    }\n  },\n\n  _displayServerWelcome() {\n    if (!this.options.server.silent) {\n      let server = this.options.server.server\n      if (server.listening) {\n        let proto = this._getServerProtocol(server)\n        let { address, port } = server.address()\n        this.local.log(`Node Monkey listening at ${proto}://${address}:${port}`)\n      } else {\n        server.on('listening', this._displayServerWelcome.bind(this))\n      }\n    }\n  },\n\n  _setupCmdMan() {\n    this._cmdMan = new CmdMan()\n    let cmdMan = this.cmdMan = this._cmdMan.bindI({\n      write: (val, opts) => {\n        console.log(val)\n      },\n      writeLn: (val, opts) => {\n        console.log(val)\n      },\n      error: (val, opts) => {\n        console.error(val)\n      },\n      prompt: (promptTxt, opts, cb) => {\n        if (typeof opts === 'function') {\n          cb = opts\n          opts = undefined\n        }\n        opts || (opts = {})\n\n        console.warn('Prompt not implemented')\n      }\n    })\n\n    this.addCmd = cmdMan.addCmd\n    this.runCmd = cmdMan.runCmd\n  },\n\n  _setupUserManager() {\n    let dataDir = this.options.dataDir\n    let userMan = this.userManager = new UserManager({\n      userFile: dataDir ? `${dataDir}/users.json` : undefined,\n      silent: this.options.server.silent\n    })\n\n    this.cmdMan.addCmd('showusers', (opts, term, done) => {\n      let users = userMan.getUsers().then(users => {\n        term.writeLn(Object.keys(users).join('\\n'))\n        done()\n      })\n    })\n\n    this.cmdMan.addCmd('adduser', (opts, term, done) => {\n      let args = opts.args,\n          username = args._[0]\n\n      if (!username) {\n        term.error(`You must specify a username`)\n        return done()\n      }\n\n      term.prompt('Password: ', { hideInput: true }, (error, password) => {\n        term.writeLn()\n        term.prompt('Again: ', { hideInput: true }, (error, passwordAgain) => {\n          term.writeLn()\n          if (password === passwordAgain) {\n            userMan.createUser(username, password)\n              .then(() => term.write(`Created user '${username}'`))\n              .catch(term.error)\n              .then(done)\n          } else {\n            term.error('Passwords do not match')\n            done()\n          }\n        })\n      })\n    })\n\n    this.cmdMan.addCmd('deluser', (opts, term, done) => {\n      let args = opts.args,\n          username = args._[0]\n\n      if (!username) {\n        term.error(`You must specify a username`)\n        return done()\n      }\n\n      userMan.deleteUser(username)\n        .then(() => term.write(`Deleted user '${username}'`))\n        .catch(term.error)\n        .then(done)\n    })\n\n    this.cmdMan.addCmd('passwd', (opts, term, done) => {\n      let args = opts.args,\n          user = opts.username\n\n      term.prompt('Current password: ', { hideInput: true }, (error, curpwd) => {\n        term.writeLn()\n        userMan.verifyUser(user, curpwd).then(matches => {\n          if (matches) {\n            term.prompt('Password: ', { hideInput: true }, (error, password) => {\n              term.writeLn()\n              term.prompt('Again: ', { hideInput: true }, (error, passwordAgain) => {\n                term.writeLn()\n                if (password === passwordAgain) {\n                  userMan.setPassword(user, password)\n                    .then(() => term.write(`Updated password for ${user}`))\n                    .catch(term.error)\n                    .then(done)\n                } else {\n                  term.error('Passwords do not match')\n                  done()\n                }\n              })\n            })\n          } else {\n            term.error('Incorrect password')\n            done()\n          }\n        })\n      })\n    })\n  },\n\n  _setupServer() {\n    let options = this.options,\n        server = options.server.server\n\n    if (!server) {\n      let serverApp = setupServer({\n        name: 'Node Monkey'\n      })\n      server = this.options.server.server = serverApp.server\n\n      let { host, port } = options.server\n      serverApp.listen(port, host)\n    }\n\n    this._displayServerWelcome()\n    this.serverApp = server\n    this.remoteClients = setupSocket({\n      server: server.server || server,\n      userManager: this.userManager,\n      onAuth: this._sendMessages.bind(this),\n      clientSettings: options.client\n    })\n  },\n\n  _setupSSH() {\n    let sshOpts = this.options.ssh\n    if (sshOpts.enabled) {\n      let dataDir = this.options.dataDir\n      if (!dataDir) {\n        throw new Error(`Options 'dataDir' is required to enable SSH`)\n      }\n\n      // Get host keys\n      let files = fs.readdirSync(dataDir),\n          keyRe = /\\.key$/,\n          hostKeys = []\n      for (let file of files) {\n        if (keyRe.test(file)) {\n          hostKeys.push(`${dataDir}/${file}`)\n        }\n      }\n\n      if (!hostKeys.length) {\n        console.log('No SSH host key found. Generating new host key...')\n        let keys = keypair()\n        fs.writeFileSync(`${dataDir}/rsa.key`, keys.private)\n        fs.writeFileSync(`${dataDir}/rsa.key.pub`, keys.public)\n        hostKeys = [ `${dataDir}/rsa.key` ]\n      }\n\n      this.SSHMan = new SSHMan({\n        monkey: this,\n        cmdManager: this._cmdMan,\n        userManager: this.userManager,\n        silent: this.options.server.silent,\n        host: sshOpts.host,\n        port: sshOpts.port,\n        title: _.result(sshOpts, 'title'),\n        prompt: _.result(sshOpts, 'prompt'),\n        hostKeys\n      })\n    }\n  },\n\n  // TODO: This whole process of trying to identify the true source of the call is so fucking messy and fragile. Need to think\n  //       of a better way to identify the call source and rewrite all this shitty code handling it right now.\n  _getCallerInfo(callerStackDistance) {\n    if (this.options.client.showCallerInfo) {\n      let stack = utils.getStack().map(frame => {\n        return {\n          functionName: frame.getFunctionName(),\n          methodName: frame.getMethodName(),\n          fileName: frame.getFileName(),\n          lineNumber: frame.getLineNumber(),\n          columnNumber: frame.getColumnNumber()\n        }\n      })\n\n      let caller = stack.find((frame, index, stack) => {\n        // We're either looking for a console method call or a bunyan log call. This logic will break down if method names change.\n        let twoBack = stack[index - 2]\n        let sixBack = stack[index - 4]\n        if (twoBack && twoBack.functionName === 'Logger._emit' && /\\/bunyan\\.js$/.test(twoBack.fileName)) {\n          return true\n        } else if (twoBack && sixBack && twoBack.methodName === 'emit' && sixBack.methodName === '_sendMessage') {\n          return true\n        }\n      })\n\n      if (!caller && typeof callerStackDistance === 'number') {\n        caller = stack[callerStackDistance]\n      }\n\n      if (caller) {\n        return {\n          caller: caller.functionName || caller.methodName,\n          file: caller.fileName,\n          line: caller.lineNumber,\n          column: caller.columnNumber\n        }\n      }\n    }\n  },\n\n  _sendMessage(info, callerStackDistance) {\n    this.msgBuffer.push({\n      method: info.method,\n      args: info.args,\n      callerInfo: info.callerInfo || this._getCallerInfo(callerStackDistance + 1)\n    })\n    if (this.msgBuffer.length > this.options.server.bufferSize) {\n      this.msgBuffer.shift()\n    }\n    this._sendMessages()\n  },\n\n  _sendMessages() {\n    let remoteClients = this.remoteClients\n    if (_.size(remoteClients.adapter.rooms['authed'])) {\n      _.each(this.msgBuffer, info => {\n        remoteClients.to('authed').emit('console', cycle.decycle(info))\n      })\n\n      this.msgBuffer = []\n    }\n  },\n\n  _createLocal() {\n    // NOTE: The console functions here should not be wrapped since these values are used to restore the defaults\n    //       when `detachConsole()` is called.\n    this.local = CONSOLE\n  },\n\n  _createRemote() {\n    let self = this\n    let remote = this.remote = {}\n    HANDLE_TYPES.forEach(method => {\n      self.remote[method] = function() {\n        self._sendMessage({\n          method,\n          args: Array.prototype.slice.call(arguments)\n        }, this.callerStackDistance ? this.callerStackDistance + 1 : 2)\n      }\n      Object.defineProperty(remote[method], 'name', { value: method })\n    })\n  },\n\n  attachConsole(disableLocalOutput) {\n    if (this._attached) {\n      return\n    }\n\n    if (!attachedCount) {\n      // If this function is in the process of handling the log call we will try and prevent potential infinite recursion\n      let handlersActive = 0\n      HANDLE_TYPES.forEach(method => {\n        console[method] = function() {\n          if (handlersActive) {\n            return self.local[method].apply(console, arguments)\n          }\n\n          ++handlersActive\n          ConsoleEvent.emit(method, ...arguments)\n          --handlersActive\n        }\n        Object.defineProperty(console[method], 'name', { value: method })\n      })\n    }\n\n    ++attachedCount\n\n    let self = this\n    let serverOptions = this.options.server\n    disableLocalOutput = disableLocalOutput !== undefined ? disableLocalOutput : serverOptions.disableLocalOutput\n\n    _.each(this.remote, (fn, method) => {\n      let handler = this._typeHandlers[method] = function() {\n        fn.apply({ callerStackDistance: 5 }, arguments)\n\n        if (!disableLocalOutput) {\n          self.local[method].apply(console, arguments)\n        }\n      }\n      Object.defineProperty(handler, 'name', { value: method })\n\n      ConsoleEvent.on(method, handler)\n    })\n\n    this._attached = true\n  },\n\n  detachConsole() {\n    Object.assign(console, this.local)\n    this._attached = false\n    --attachedCount\n\n    HANDLE_TYPES.forEach(method => {\n      ConsoleEvent.removeListener(method, this._typeHandlers[method])\n      delete this._typeHandlers[method]\n    })\n  }\n})\n\n\nlet instances = {}\nlet lastPort = DEFAULT_PORT - 1\nmodule.exports = function createInst(options, name = 'default') {\n  if (typeof options === 'string') {\n    name = options\n    options = undefined\n  }\n\n  if (!instances[name]) {\n    options || (options = {})\n    let port = _.get(options, 'server.port')\n    if (port) {\n      lastPort = +port\n    } else {\n      _.set(options, 'server.port', ++lastPort)\n      _.set(options, 'ssh.port', ++lastPort)\n    }\n    instances[name] = new NodeMonkey(options)\n  }\n\n  return instances[name]\n}\n\n// Just exporting in case someone needs to wrap this or access the internals for some reason\nmodule.exports.NodeMonkey = NodeMonkey\n\n\n// WEBPACK FOOTER //\n// ./server/app.js","module.exports = require(\"minimist\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"minimist\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"pty.js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pty.js\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"restify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"restify\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"scrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"scrypt\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"source-map-support\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"source-map-support\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"ssh2\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ssh2\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"terminal-kit\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"terminal-kit\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"tty\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tty\"\n// module id = 31\n// module chunks = 0"],"sourceRoot":""}